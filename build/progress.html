<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>Progressing...</title>
    <link rel="shortcut icon" href="../assets/icons/win/progress.png" />
    <link href="../lib/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="css/form.css" rel="stylesheet" type="text/css" />
    <style>
        html, body {
            text-align: center;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            border: 1px solid black;
        }

        progress {
            width: 95%;
        }
    </style>
</head>
<body>
    <div id="title">Progressing&hellip;</div>
    <div>
        <progress max="100" id="progressbar"></progress>
    </div>
    <div>
        <button id="cancel" onclick="ipcRenderer.send('progress-canceled');window.close();">
            Cancel
        </button>
    </div>
</body>
<script>
    if (typeof module === 'object') { window.module = module; module = undefined; }
</script>
<script src="../lib/jquery.min.js" type="text/javascript"></script>
<script src="../lib/bootstrap.min.js" type="text/javascript"></script>
<script>
    $(window).keydown((event) => {
        if (event.which === 27) {
            window.close();
            ipcRenderer.send('progress-canceled');
        }
    });

    const { ipcRenderer } = require('electron');

    ipcRenderer.on('progress', (event, progressObj) => {
        if (progressObj.title) {
            document.getElementById('title').innerHTML = progressObj.title;
            document.title = document.getElementById('title').textContent;
        }
        document.getElementById('progressbar').value = progressObj.percent;
    });

    ipcRenderer.on('progress-title', (event, title) => {
        console.log(title);
        document.getElementById('title').innerHTML = title;
        document.title = document.getElementById('title').textContent;
    });

    ipcRenderer.on('progress-close', () => {
        window.close();
        ipcRenderer.send('progress-closed');
    });
    ipcRenderer.send('progress-loaded');
</script>