<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>Immortal Tools</title>
    <link rel="shortcut icon" href="../assets/icons/png/ied.png" />
    <link href="../lib/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-treeview.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="css/mail.css" rel="stylesheet" type="text/css" />
    <link href="css/form.css" rel="stylesheet" type="text/css" />
    <link href="css/ansi.css" rel="stylesheet" type="text/css" />
    <link href="css/theme.css" rel="stylesheet" type="text/css" />
    <link href="../lib/datatables.min.css" rel="stylesheet" type="text/css" />
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <script src="../lib/jquery.min.js" type="text/javascript"></script>
    <script src="../lib/bootstrap.min.js" type="text/javascript"></script>
    <script src="../lib/bootstrap-select.min.js" type="text/javascript"></script>
    <script src="../lib/datatables.min.js" type="text/javascript"></script>
    <script src="../lib/datatables.scrollresize.js" type="text/javascript"></script>
    <script>
        //cSpell:ignore hellip datatable, datatables, scrollresize, drivelist, prefs, unref, toggledevtools, readdir, mountpoints, estart, showhidden, extname, prepend, mkdir
        //cSpell:ignore keypress, haspopup, labelledby, tabindex, tablist, tabpanel
        const { MailStatus, MailAction } = require('./js/types');
        const { remote, ipcRenderer, shell, clipboard } = require('electron');
        const { app, dialog, Menu, MenuItem } = remote;
        const { parseTemplate, existsSync } = require('./js/library');
        const { Settings } = require('./js/settings');
        const { Display } = require('./js/display');
        const { Mail } = require('./js/mail');
        const fs = require('fs-extra');
        const child_process = require('child_process');
        const path = require('path');
        const drivelist = require('drivelist');
        const moment = require('moment');

        var options;
        var logView;
        var display;
        var messageTable;
        var _updating;
        var dragging = false, btmDragging = false;
        var mail;

        var menu = [
            {
                label: '&File',
                id: 'file',
                submenu: [
                    {
                        label: 'C&ompose',
                        accelerator: "CmdOrCtrl+N",
                        enabled: true,
                        //click: download
                    },
                    { type: 'separator' },
                    {
                        label: '&Get new mail',
                        accelerator: "CmdOrCtrl+S",
                        enabled: true,
                        //click: download
                    },
                    {
                        label: '&Sync to mud',
                        accelerator: "CmdOrCtrl+S",
                        enabled: true,
                        //click: download
                    },
                    { type: 'separator' },
                    {
                        label: '&Preferences...',
                        accelerator: "CmdOrCtrl+Comma",
                        click: () => {
                            window.open('mail.prefs.html', 'modal', 'backgroundColor=#fff,height=300,width=600,icon=' + path.join(__dirname, '../assets/icons/png/preferences.png'));
                        }
                    },
                    { type: 'separator' },
                    {
                        label: '&Close',
                        click: () => { window.close(); }
                    }
                ]
            },
            {
                label: '&Mail',
                submenu: [
                    {
                        label: 'Reply',
                        accelerator: "CmdOrCtrl+N",
                        enabled: true,
                        //click: download
                    },
                    {
                        label: '&Reply all',
                        accelerator: "CmdOrCtrl+S",
                        enabled: true,
                        //click: download
                    },
                    {
                        label: '&Forward',
                        accelerator: "CmdOrCtrl+S",
                        enabled: true,
                        //click: download
                    }
                ]
            },
            {
                label: '&Edit',
                submenu: [
                    {
                        label: '&Refresh list',
                        accelerator: "F5",
                        click: () => {

                        }
                    },
                    {
                        label: '&Refresh view',
                        accelerator: "CmdOrCtrl+F5",
                        click: () => {

                        }
                    },

                    {
                        label: '&Refresh all',
                        accelerator: "CmdOrCtrl+Shift+F5",
                        click: () => {

                        }
                    },
                    { type: 'separator' },
                    {
                        label: 'Cu&t',
                        accelerator: 'CmdOrCtrl+X',
                        click: () => {

                        }
                    },
                    {
                        label: '&Copy',
                        accelerator: 'CmdOrCtrl+C',
                        click: () => {

                        }
                    },
                    {
                        label: '&Paste',
                        accelerator: 'CmdOrCtrl+V',
                        click: () => {

                        }
                    },
                    {
                        label: '&Delete',
                        accelerator: 'Delete',
                        click: () => {

                        }
                    },
                    { type: 'separator' },
                    {
                        label: '&Select all',
                        click: () => {

                        }
                    },
                    { type: 'separator' },
                    {
                        label: '&Find',
                        click: () => {

                        }
                    },
                    { type: 'separator' },
                    {
                        label: '&Clear log',
                        click: () => {
                            logView.html('');
                        }
                    }
                ]
            },

            {
                label: '&View',
                submenu: [
                    {
                        label: '&Inbox',
                        type: 'checkbox',
                        checked: true,
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },

                    {
                        label: '&Drafts',
                        type: 'checkbox',
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },

                    {
                        label: '&Sent',
                        type: 'checkbox',
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },

                    {
                        label: '&Trash',
                        type: 'checkbox',
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },


                    { type: 'separator' },
                    {
                        label: '&Headers',
                        checked: true,
                        type: 'checkbox',
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },
                    { type: 'separator' },
                    {
                        label: '&Raw',
                        type: 'checkbox',
                        accelerator: "CmdOrCtrl+Q",
                        click: () => { }
                    },
                    {
                        label: '&Formated',
                        type: 'checkbox',
                        checked: true,
                        accelerator: "CmdOrCtrl+Shift+S",
                        click: () => { }
                    },
                    { type: 'separator' },
                    {
                        role: 'toggledevtools'
                    },
                    {
                        type: 'separator'
                    },
                    {
                        role: 'resetzoom'
                    },
                    {
                        role: 'zoomin'
                    },
                    {
                        role: 'zoomout'
                    },
                ]
            },

        ];
        var menubar = Menu.buildFromTemplate(menu);
        remote.getCurrentWindow().setMenu(menubar);

        function updateMenuItem(args) {
            var item, i = 0, items;
            var tItem, tItems;
            if (args == null || args.menu == null) return;

            if (!Array.isArray(args.menu))
                args.menu = args.menu.split('|');

            items = menubar.items;
            tItems = menu;
            for (i = 0; i < args.menu.length; i++) {
                if (!items || items.length === 0) break;
                for (var m = 0; m < items.length; m++) {
                    if (!items[m]) continue;
                    if (items[m].id === args.menu[i] || (items[m].label || '').toLowerCase().replace(/&/g, '') === args.menu[i].toLowerCase()) {
                        item = items[m];
                        tItem = tItems[m];
                        if (item.submenu) {
                            items = item.submenu.items;
                            tItems = tItem.submenu;
                        }
                        else
                            items = null;
                        break;
                    }
                }
            }
            if (!item)
                return;
            if (args.enabled != null)
                item.enabled = args.enabled ? true : false;
            if (args.checked != null)
                item.checked = args.checked ? true : false;
            if (args.icon != null)
                item.icon = args.icon;
            if (args.visible != null)
                item.visible = args.visible ? true : false;
            if (args.position != null)
                item.position = args.position;

            tItem.enabled = item.enabled;
            tItem.checked = item.checked;
            tItem.icon = item.icon;
            tItem.visible = item.visible;
            tItem.position = item.position;
        }

        (function () {
            /*
                     * Natural Sort algorithm for Javascript - Version 0.7 - Released under MIT license
                     * Author: Jim Palmer (based on chunking idea from Dave Koelle)
                     * Contributors: Mike Grier (mgrier.com), Clint Priest, Kyle Adams, guillermo
                     * See: http://js-naturalsort.googlecode.com/svn/trunk/naturalSort.js
                     */
            function naturalSort(a, b, html) {
                var re = /(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?%?$|^0x[0-9a-f]+$|[0-9]+)/gi,
                    sre = /(^[ ]*|[ ]*$)/g,
                    dre = /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,
                    hre = /^0x[0-9a-f]+$/i,
                    ore = /^0/,
                    htmre = /(<([^>]+)>)/ig,
                    // convert all to strings and trim()
                    x = a.toString().replace(sre, '') || '',
                    y = b.toString().replace(sre, '') || '';
                // remove html from strings if desired
                if (!html) {
                    x = x.replace(htmre, '');
                    y = y.replace(htmre, '');
                }
                // chunk/tokenize
                var xN = x.replace(re, '\0$1\0').replace(/\0$/, '').replace(/^\0/, '').split('\0'),
                    yN = y.replace(re, '\0$1\0').replace(/\0$/, '').replace(/^\0/, '').split('\0'),
                    // numeric, hex or date detection
                    xD = parseInt(x.match(hre), 10) || (xN.length !== 1 && x.match(dre) && Date.parse(x)),
                    yD = parseInt(y.match(hre), 10) || xD && y.match(dre) && Date.parse(y) || null;

                // first try and sort Hex codes or Dates
                if (yD) {
                    if (xD < yD) {
                        return -1;
                    }
                    else if (xD > yD) {
                        return 1;
                    }
                }

                // natural sorting through split numeric strings and default strings
                for (var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {
                    // find floats not starting with '0', string or 0 if not defined (Clint Priest)
                    var oFxNcL = !(xN[cLoc] || '').match(ore) && parseFloat(xN[cLoc], 10) || xN[cLoc] || 0;
                    var oFyNcL = !(yN[cLoc] || '').match(ore) && parseFloat(yN[cLoc], 10) || yN[cLoc] || 0;
                    // handle numeric vs string comparison - number < string - (Kyle Adams)
                    if (isNaN(oFxNcL) !== isNaN(oFyNcL)) {
                        return (isNaN(oFxNcL)) ? 1 : -1;
                    }
                    // rely on string comparison if different types - i.e. '02' < 2 != '02' < '2'
                    else if (typeof oFxNcL !== typeof oFyNcL) {
                        oFxNcL += '';
                        oFyNcL += '';
                    }
                    if (typeof oFxNcL === 'string') {
                        oFxNcL = oFxNcL.toLowerCase();
                        oFyNcL = oFyNcL.toLowerCase();
                    }
                    if (oFxNcL < oFyNcL) {
                        return -1;
                    }
                    if (oFxNcL > oFyNcL) {
                        return 1;
                    }
                }
                return 0;
            }

            jQuery.extend(jQuery.fn.dataTableExt.oSort, {
                "moment-asc": function (a, b) {
                    if (moment(a).isBefore(b))
                        return -1;
                    if (moment(b).isBefore(a))
                        return 1;
                    return 0;
                },

                "moment-desc": function (a, b) {
                    if (moment(a).isBefore(b))
                        return 1;
                    if (moment(b).isBefore(a))
                        return -1;
                    return 0;
                },

            });

            jQuery.fn.dataTable.ext.type.order['file-size-pre'] = function (data) {
                var matches = data.match(/^(\d+(?:\.\d+)?)\s*([a-z]+)/i);
                var multipliers;

                if (process.platform === 'darwin')
                    multipliers = {
                        b: 1,
                        bytes: 1,
                        kb: 1000,
                        kib: 1024,
                        mb: 1000000,
                        mib: 1048576,
                        gb: 1000000000,
                        gib: 1073741824,
                        tb: 1000000000000,
                        tib: 1099511627776,
                        pb: 1000000000000000,
                        pib: 1125899906842624
                    };
                else
                    multipliers = {
                        b: 1,
                        bytes: 1,
                        kb: 1024,
                        kib: 1024,
                        mb: 1048576,
                        mib: 1048576,
                        gb: 1073741824,
                        gib: 1073741824,
                        tb: 1099511627776,
                        tib: 1099511627776,
                        pb: 1125899906842624,
                        pib: 1125899906842624
                    };

                if (matches) {
                    var multiplier = multipliers[matches[2].toLowerCase()];
                    return parseFloat(matches[1]) * multiplier;
                } else {
                    return -1;
                }
            };
        }());

        function loadOptions(data) {
            if (!data) {
                var set = Settings.load(remote.getGlobal('settingsFile'));
                options = set.extensions["mail"];
            }
            else
                options = data;
            if (!options) {
                options = {
                    'folderSize': 202,
                    'viewSize': 250,
                    'showHeaders': true,
                    'showRaw': false,
                    'viewFont': '\'Courier New\', Courier, monospace',
                    'viewFontSize': '1em',
                };
                saveOptions();
            }
            if (options.folderSize < 202)
                options.folderSize = 202;
            if (options.viewSize < 202)
                options.viewSize = 202;
            $('#folders').css("width", options.folderSize);
            $('#messages').css("left", options.folderSize);
            $('#bottom').css("height", options.viewSize);
            $('#main').css("bottom", options.viewSize + 26);
            if (options.showHeaders) {
                $('#view-headers').css('display', '');
                $('#view-body').css('top', '');
            }
            else {
                $('#view-headers').css('display', 'none');
                $('#view-body').css('top', '2px');
            }
            display.updateFont(options.viewFont, options.viewFontSize);
            doUpdate(2);
        }

        function saveOptions() {
            ipcRenderer.send('setting-changed', { type: 'extensions', name: 'mail', value: options });
        }

        function logMessage(msg) {
            if (!msg) return;
            logView.html(logView.html() + msg.toString() + "<br>");
        }

        function logError(error) {
            if (!error) return;
            var msg;
            if (error.stack)
                msg = error.stack;
            else if (error instanceof TypeError)
                msg = error.name + " - " + error.message;
            else if (error instanceof Error)
                msg = error.name + " - " + error.message;
            else if (error.message)
                msg = error.message;
            else
                msg = error;
            if (options.debug)
                console.log(error);
            if (options.logErrors) {
                fs.writeFileSync(parseTemplate(path.join('{data}', "jimud.error.log")), "Immortal Tools: " + new Date().toLocaleString() + '\n', { flag: 'a' });
                fs.writeFileSync(parseTemplate(path.join('{data}', "jimud.error.log")), msg + '\n', { flag: 'a' });
            }
        }
        $(document).ready(() => {
            var file = remote.getGlobal('character');
            if (!file || file.length === 0)
                file = parseTemplate(path.join("{data}", "mail.sqlite"));
            else
                file = parseTemplate(path.join("{characters}", file + ".mail"));
            mail = new Mail(file);

            $('#messages-list').DataTable({
                keys: true,
                paging: false,
                select: {
                    style: 'os'
                },
                searching: false,
                info: false,
                scrollY: 300,
                scrollX: 300,
                fixedHeader: {
                    header: true,
                    footer: false
                },
                scrollResize: true,
                language: { zeroRecords: '', emptyTable: '' },
                autoWidth: false,
                order: [[3, "desc"]],
                columnDefs: [
                    {
                        targets: 0,
                        render: function (data, type, full, meta) {
                            return `<input type="checkbox" value="${data.id}"/>`;
                        },
                        "orderable": false
                    },
                    {
                        type: "moment",
                        targets: 2,
                        orderData: [2, 1, 0],
                        render: function (data) {
                            return new moment(data).format('MM/DD/YYYY hh:mm:ss A');
                        }
                    },
                    {
                        targets: 4,
                        visible: false
                    }
                ],
                columns: [
                    { data: 'check', width: '20px' },
                    { data: 'from', width: '200px' },
                    { data: 'subject' },
                    { data: 'date', width: '200px' },
                    { data: 'id' },
                ]
            });
            messageTable = $('#messages-list').DataTable();

            messageTable.on('user-select', function (e, dt, type, cell, originalEvent) {
                if ($(cell.node()).parent().hasClass('selected') && dt.rows('.selected').data().length === 1) {
                    e.preventDefault();
                }
            });

            messageTable.on('select', function (e, dt, type, indexes) {
                if (type === 'row')
                    doUpdate(4);
            });

            messageTable.on('deselect', function (e, dt, type, indexes) {
                if (type === 'row')
                    doUpdate(4);
            });

            $('#messages-list tbody').on('contextmenu', 'tr', function (e) {
                event.preventDefault();
                event.stopPropagation();
                event.cancelBubble = true;
                if (!$(this).hasClass('selected')) {
                    messageTable.rows().deselect();
                    messageTable.row(this).select();
                }
                //showLocalContextMenu();
            });

            $('#messages-list-container').on('contextmenu', function (e) {
                event.preventDefault();
                event.stopPropagation();
                event.cancelBubble = true;
                //showLocalContextMenu();
            });

            $('#messages-list tbody').on('dblclick', 'tr', function () {
                /*
                var data = localTable.row(this).data();
                if(!data) return;
                if (data.size === -2) {
                    if (options.syncFolders) {
                        if (_remote[data.name] && path.basename(options.remote) === path.basename(options.local))
                            _ied.getDir(options.remote + "/" + data.name, true);
                    }
                    updateLocal(data.path);
                }
                else
                    _ied.upload(data.path);
                    */
            });

            $("#messages-list").on('focus', () => {
                $("#messages-list").addClass('focused');
                doUpdate(4);
            });

            $('#drag-bar').mousedown(function (e) {
                e.preventDefault();
                dragging = true;
                var main = $('#messages');
                var ghostBar = $('<div>',
                    {
                        id: 'ghost-bar',
                        css: {
                            height: main.outerHeight(),
                            top: main.offset().top,
                            left: main.offset().left - 3
                        }
                    }).appendTo('body');

                $(document).mousemove(function (e) {
                    if (e.pageX < 199)
                        ghostBar.css("left", 199);
                    else if (e.pageX > document.body.clientWidth - 300)
                        ghostBar.css("left", document.body.clientWidth - 300);
                    else
                        ghostBar.css("left", e.pageX);
                });
            });

            $('#btm-drag-bar').mousedown(function (e) {
                e.preventDefault();
                btmDragging = true;
                var main = $('#bottom');
                var ghostBar = $('<div>',
                    {
                        id: 'btm-ghost-bar',
                        css: {
                            width: main.outerWidth(),
                            top: main.offset().top,
                            left: main.offset().left
                        }
                    }).appendTo('body');

                $(document).mousemove(function (e) {
                    if (e.pageY < 199)
                        ghostBar.css("top", 199);
                    else if (e.pageY > document.body.clientHeight - 200)
                        ghostBar.css("top", document.body.clientHeight - 200);
                    else
                        ghostBar.css("top", e.pageY);
                });
            });

            $(window).on('resize', () => {
                if ($('#messages').outerWidth() < 300 && $("#folders").outerWidth() > 202) {
                    $('#folders').css("width", document.body.clientWidth - 300);
                    $('#messages').css("left", document.body.clientWidth - 300);
                    options.folderSize = document.body.clientWidth - 300;
                    saveOptions();
                }

                if ($('#bottom').outerHeight() < 200 && $("#main").outerHeight() > 202) {
                    options.viewSize = 200;
                    $('#bottom').css("height", options.viewSize);
                    $('#main').css("bottom", options.viewSize + 26);
                    saveOptions();
                }

                var h = $("#main").outerHeight() - 40;
                if (options.showQueue)
                    h += $("#bottom").outerHeight();
                doUpdate(2);
            });

            $(document).mouseup(function (e) {
                if (dragging) {
                    if (e.pageX < 200) {
                        $('#folders').css("width", 202);
                        $('#messages').css("left", 202);
                        options.folderSize = 202;
                    }
                    else if (e.pageX > document.body.clientWidth - 300) {
                        $('#folders').css("width", document.body.clientWidth - 300);
                        $('#messages').css("left", document.body.clientWidth - 300);
                        options.folderSize = document.body.clientWidth - 300;
                    }
                    else {
                        $('#folders').css("width", e.pageX + 2);
                        $('#messages').css("left", e.pageX + 2);
                        options.folderSize = e.pageX + 2;
                    }
                    doUpdate(2);
                    saveOptions();
                    $('#ghost-bar').remove();
                    $(document).unbind('mousemove');
                    dragging = false;
                }
                else if (btmDragging) {
                    if (e.pageY < 226)
                        options.viewSize = document.body.clientHeight - 202;
                    else if (e.pageY > document.body.clientHeight - 200)
                        options.viewSize = 200;
                    else
                        options.viewSize = document.body.clientHeight - e.pageY + 2;
                    options.viewSize -= 26;
                    $('#bottom').css("height", options.viewSize);
                    $('#main').css("bottom", options.viewSize + 26);
                    doUpdate(2);
                    saveOptions();
                    $('#btm-ghost-bar').remove();
                    $(document).unbind('mousemove');
                    btmDragging = false;
                }
            });

            updateMessages();
            display = new Display($("#display"));
            display.scrollToEnd = false;
            display.maxLines = -1;
            loadOptions();
            $(document).keydown((event) => {
                switch (event.which) {
                    case 116: //f5
                        if (!event.altKey && !event.ctrlKey && !event.shiftKey && !event.metaKey) {
                            if ($("#messages-list").hasClass("focused"))
                                updateMessages();
                            event.preventDefault();
                        }
                        break;
                    case 46://delete
                        if (!event.altKey && !event.ctrlKey && !event.shiftKey && !event.metaKey) {
                            //if ($("#messages-list").hasClass("focused"))
                            //deleteLocal();
                            event.preventDefault();
                        }
                        break;
                    case 65://select all, hack as menu accelerator doesn't work
                        if (!event.altKey && event.ctrlKey && !event.shiftKey && !event.metaKey) {
                            //if ($("#messages-list").hasClass("focused"))
                            //messageTable.rows().select();
                            event.preventDefault();
                        }
                        break;
                }
            });


            $(window).trigger('resize');
        });

        function updateMessages() {
            $("#messages-list_wrapper .dataTables_scrollBody")[0].scrollTop = 0;
        }

        function doUpdate(type) {
            if (!type) return;
            _updating |= type;
            if (_updating === 0)
                return;
            window.requestAnimationFrame(() => {
                if ((this._updating & 1) === 1) {
                    //updateStatus();
                    _updating &= ~1;
                }
                if ((this._updating & 2) === 2) {
                    if (messageTable)
                        updateDraw(messageTable);
                    _updating &= ~2;
                }
                if ((this._updating & 4) === 4) {
                    //updateMenu();
                    _updating &= ~4;
                }
                if ((this._updating & 32) === 32) {
                    logView[0].scrollTop = logView[0].scrollHeight;
                    _updating &= ~32;
                }
                doUpdate(_updating);
            });
        }

        function updateDraw(table, what) {
            if (!table) return;
            if (!what) what = table;
            var body = $(".dataTables_scrollBody", table.table().container())[0];
            var st = body.scrollTop;
            what.draw();
            body.scrollTop = st;
        }

        function focusRow(row) {
            if (!row || row.length === 0) return;
            var top = row.node().offsetTop;
            var body = $(".dataTables_scrollBody", row.table().container())[0];
            var sTop = body.scrollTop;
            var sHeight = body.clientHeight;
            if (top < sTop || top + 31 >= sTop + sHeight)
                body.scrollTop = top;
        }

    </script>
</head>

<body>
    <div id="toolbar" class="btn-toolbar" role="toolbar">
        <div class="btn-group" role="group" id="queue-controls">
            <button id="btn-get" type="button" class="btn btn-default btn-xs" title="Get new mail">
                <i class="fa fa-envelope-open"></i>
            </button>
            <button id="btn-sync" type="button" class="btn btn-default btn-xs" title="Sync to mud">
                <i class="fa fa-exchange"></i>
            </button>
        </div>
        <button id="btn-compose" type="button" class="btn btn-default btn-xs" title="Compose" onclick="queueStart()">
            <i class="fa fa-plus"></i>
        </button>
        <button id="btn-delete" disabled="disabled" type="button" class="btn btn-danger btn-xs" title="Pause" onclick="queuePause()" data-toggle="button">
            <i class="fa fa-remove"></i>
        </button>

        <div class="btn-group" role="group" id="queue-controls">
            <button id="btn-pause" disabled="disabled" type="button" class="btn btn-default btn-xs" title="Reply" onclick="queuePause()" data-toggle="button">
                <i class="fa fa-reply"></i>
            </button>
            <button id="btn-stop" disabled="disabled" type="button" class="btn btn-default btn-xs" title="Reply all" onclick="queueStop()">
                <i class="fa fa-reply-all"></i>
            </button>
            <button id="btn-pause" disabled="disabled" type="button" class="btn btn-default btn-xs" title="Forward" onclick="queuePause()" data-toggle="button">
                <i class="fa fa-mail-forward"></i>
            </button>

        </div>
        <div class="input-group" style="float: right; width: 150px">
            <input type="text" id="search" class="input-xs form-control" />
            <span class="input-group-btn">
                <button class="btn btn-default btn-xs" type="button" id="btn-search">
                    <i class="fa fa-search "></i>
                </button>
        </div>
    </div>

    <div id="main">
        <div id="folders">
            <div class="panel panel-default">
                <div id="folder-container" class="list-group" style="padding:0px;top:0px;bottom:1px;left:1px;right:5px;position: absolute;">
                    <a class="list-group-item active" href="javascript:void()">
                        <i class="fa fa-inbox"></i> Inbox</a>
                    <a class="list-group-item" href="javascript:void()">
                        <i class="fa fa-edit"></i> Drafts</a>
                    <a class="list-group-item" href="javascript:void()">
                        <i class="fa fa-envelope-o"></i> Sent</a>
                    <a class="list-group-item" href="javascript:void()">
                        <i class="fa fa-trash"></i> Trash</a>
                </div>
            </div>
            <div id="drag-bar"></div>
        </div>
        <div id="messages">
            <div class="panel panel-default">
                <div id="messages-list-container" class="panel-body" style="padding:0px;top:0px;bottom:1px;left:1px;right:1px;position: absolute;">
                    <table tabindex="0" id="messages-list" draggable="true" class="table table-striped table-hover table-condensed" style="width: 100%;height: 100%;padding:0px;margin:0px !important;">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" />
                                </th>
                                <th>From</th>
                                <th>Subject</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="bottom">
        <div id="btm-drag-bar"></div>
        <div class="panel panel-default" style="margin-bottom:0px;padding:0px;top:5px;bottom:0px;left:0px;right:0px;position: absolute;">
            <div id="view-headers" class="panel-heading">
                <button style="float: right" class="btn btn-default btn-xs" type="button" id="btn-hide">
                    <i class="fa fa-remove"></i>
                </button>
                <div>From:
                    <span id="from"></span>
                </div>
                <div id="ccs">CC:
                    <span id="cc"></span>
                </div>
                <div>Date:
                    <span id="date"></span>
                </div>
                <div>Subject:
                    <span id="subject"></span>
                </div>
            </div>
            <div id="view-body" class="panel-body">
                <div id="display"></div>
            </div>
        </div>
    </div>
    <div id="status" class="btn-toolbar" role="toolbar">
        <div id="messagesInfo" style="float:right;display:block;"></div>
    </div>
    <dialog id="Progress" style="z-index:1000;text-align:center">
        <div id="ProgressTitle"></div>
        <div id="Progressbar">
            <progress max="100"></progress>
        </div>
    </dialog>
</body>

</html>