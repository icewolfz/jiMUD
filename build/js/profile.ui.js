"use strict";var _Mathfloor=Math.floor;Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),{dialog,Menu,MenuItem}=electron_1.remote,library_1=require("./library"),profile_1=require("./profile"),settings_1=require("./settings"),path=require("path"),fs=require("fs");var profiles=new profile_1.ProfileCollection,currentProfile,currentNode,watcher,fchanged=!1,_clip,_pUndo,_undo=[],_redo=[],_remove=[],_never=!0,_close;const addmenu=new Menu;addmenu.append(new MenuItem({label:"Add empty profile",click(){clearButton("#addmenu"),AddProfile()}})),addmenu.append(new MenuItem({label:"Add profile with defaults",click(){clearButton("#addmenu"),AddProfile(!0)}})),addmenu.append(new MenuItem({type:"separator"})),addmenu.append(new MenuItem({label:"Add alias",click(){clearButton("#addmenu"),addItem("Alias","aliases",new profile_1.Alias)}})),addmenu.append(new MenuItem({label:"Add macro",click(){clearButton("#addmenu"),addItem("Macro","macros",new profile_1.Macro)}})),addmenu.append(new MenuItem({label:"Add trigger",click(){clearButton("#addmenu"),addItem("Trigger","triggers",new profile_1.Trigger)}})),addmenu.append(new MenuItem({label:"Add button",click(){clearButton("#addmenu"),addItem("Button","buttons",new profile_1.Button)}}));function profileID(g){return g.toLowerCase().replace(/^[^a-z]+|[^\w:.-]+/gi,"-")}function AddNewItem(){var g;currentNode&&(currentNode.state.selected=!1,g="profile",g=currentNode.dataAttr.type?currentNode.dataAttr.type:currentNode.text.toLowerCase(),"profile"===g?AddProfile(!0):"aliases"===g||"alias"===g?addItem("Alias","aliases",new profile_1.Alias):"macros"===g||"macro"===g?addItem("Macro","macros",new profile_1.Macro):"triggers"===g||"trigger"===g?addItem("Trigger","triggers",new profile_1.Trigger):"buttons"===g||"button"===g?addItem("Button","buttons",new profile_1.Button):void 0)}function AddProfile(g){for(var u=profiles.length,A="NewProfile"+u;profiles.contains(A);)u++,A="NewProfile"+u;var v=new profile_1.Profile(A);g||(v.macros=[]),profiles.add(v);var w=A;A=A.toLowerCase();var N={text:w,id:"Profile"+profileID(A),state:{checked:profiles.items[A].enabled},dataAttr:{type:"profile",profile:A},nodes:[{text:"Aliases",id:"Profile"+profileID(A)+"aliases",dataAttr:{profile:A},lazyLoad:0<profiles.items[A].aliases.length,state:{checked:profiles.items[A].enableAliases}},{text:"Macros",id:"Profile"+profileID(A)+"macros",dataAttr:{profile:A},lazyLoad:0<profiles.items[A].macros.length,state:{checked:profiles.items[A].enableMacros}},{text:"Triggers",id:"Profile"+profileID(A)+"triggers",dataAttr:{profile:A},lazyLoad:0<profiles.items[A].triggers.length,state:{checked:profiles.items[A].enableTriggers}},{text:"Buttons",id:"Profile"+profileID(A)+"buttons",dataAttr:{profile:A},lazyLoad:0<profiles.items[A].buttons.length,state:{checked:profiles.items[A].enableButtons}}]};$("#tree").treeview("addNode",[N,!1,!1]),pushUndo({action:"add",type:"profile",item:[v.name.toLowerCase()]})}function RunTester(){if(0===$("#TriggerTestText").val().length)return void $("#TriggerTestResults").val("No text to test against!");try{if($("#TriggerVerbatim").prop("checked"))$("#TriggerName").val()==$("#TriggerTestText").val()?$("#TriggerTestResults").val("%0 : "+$("#TriggerTestText").val()+"\n"):$("#TriggerTestResults").val("Pattern doesn't Match!");else{var g=new RegExp($("#TriggerName").val(),"g"),u=g.exec($("#TriggerTestText").val());if(null===u||0===u.length)$("#TriggerTestResults").val("Pattern doesn't Match!");else{var A="";for(i=0;i<u.length;i++)A+="%"+i+" : "+u[i]+"\n";$("#TriggerTestResults").val(A)}}}catch(v){$("#TriggerTestResults").val("Error: "+v)}}exports.RunTester=RunTester;function UpdateButtonSample(){var g=$("#buttonsample");$("#ButtonStretch").prop("checked")?g.addClass("button-stretch"):g.removeClass("button-stretch"),g.prop("title",$("#ButtonCaption").val());var u=$("#ButtonIcon").val();u.startsWith("fa-")?g.html("<i class=\"fa "+u+"\"></i>"):u.startsWith("gi-")?g.html("<i class=\"glyphicon glyphicon-"+u.substring(3)+"\"></i>"):u.startsWith("glyphicon-")?g.html("<i class=\"glyphicon "+u+"\"></i>"):u.startsWith(".")?g.html("<i class=\"fa button-icon "+u.substring(1)+"\"></i>"):0<u.length?g.html("<img src=\""+library_1.parseTemplate(u)+"\" />"):g.html("<i class=\"fa fa-question\"></i>")}exports.UpdateButtonSample=UpdateButtonSample;function openImage(){dialog.showOpenDialog(electron_1.remote.getCurrentWindow(),{defaultPath:path.dirname($("#ButtonIcon").val()),filters:[{name:"Images (*.jpg, *.png, *.gif)",extensions:["jpg","png","gif"]},{name:"All files (*.*)",extensions:["*"]}]},function(g){void 0===g||($("#ButtonIcon").val(g[0]),UpdateButtonSample())})}exports.openImage=openImage;function MacroeKeys(g){if(0===g.key)return"None";var u=[];if((g.modifiers&profile_1.MacroModifiers.Ctrl)==profile_1.MacroModifiers.Ctrl&&u.push("Ctrl"),(g.modifiers&profile_1.MacroModifiers.Alt)==profile_1.MacroModifiers.Alt&&u.push("Alt"),(g.modifiers&profile_1.MacroModifiers.Shift)==profile_1.MacroModifiers.Shift&&u.push("Shift"),(g.modifiers&profile_1.MacroModifiers.Meta)==profile_1.MacroModifiers.Meta&&("darwin"==process.platform?u.push("Cmd"):u.push("Win")),library_1.keyCodeToChar[g.key])u.push(library_1.keyCodeToChar[g.key]);else return"None";return u.join("+")}function clearButton(g){$(g).removeClass("open"),$(g).blur()}function GetDisplay(g){if(1==g.displaytype){var u=new Function("item",g.display);return u(g)}return $.isFunction(g.display)?g.display(g):$.isFunction(g[g.display])?g[g.display](g):g[g.display]}function addItem(g,u,A,v,w,N){w||(w=currentProfile),v||(v=w[u].length),g=g.toLowerCase();var P=$("#tree").treeview("findNodes",["Profile"+profileID(w.name)+u,"id"]);$("#tree").treeview("expandNode",[P,{levels:1,silent:!1}]),w[u][v]=A;var T=[{text:GetDisplay(A),id:"Profile"+profileID(w.name)+u+v,dataAttr:{type:g.toLowerCase(),profile:w.name.toLowerCase(),id:"Profile"+profileID(w.name)+u+v,index:v},state:{checked:A.enabled,selected:!0}}];$("#tree").treeview("addNode",[T,P,!1,{silent:!1}]),$("#tree").treeview("selectNode",[T,{silent:!1}]),N&&pushUndo({action:"add",type:g.toLowerCase(),item:A.clone(),data:{type:g,key:u,item:A,id:v,profile:w.name.toLowerCase()}})}function UpdateEnabled(){var g="profile";if(!currentNode.dataAttr.type){var u=$("#tree").treeview("getParents",currentNode)[0];g=u.dataAttr.type}else g=currentNode.dataAttr.type;switch(g){case"aliases":case"macros":case"triggers":case"buttons":case"profile":var u=$("#tree").treeview("findNodes",["^Profile"+profileID(currentProfile.name)+"$","id"]);$("#enabled").prop("checked")?currentProfile.enabled!=$("#enabled").prop("checked")&&($("#enabled").prop("checked")?$("#tree").treeview("checkNode",[u,{silent:!0}]):$("#tree").treeview("uncheckNode",[u,{silent:!0}]),pushUndo({action:"update",type:"profile",profile:currentProfile.name,data:{enabled:currentProfile.enabled}}),currentProfile.enabled=$("#enabled").prop("checked")):profiles.canDisable(currentProfile)?($("#enabled").prop("checked")?$("#tree").treeview("checkNode",[u,{silent:!0}]):$("#tree").treeview("uncheckNode",[u,{silent:!0}]),pushUndo({action:"update",type:"profile",profile:currentProfile.name,data:{enabled:currentProfile.enabled}}),currentProfile.enabled=$("#enabled").prop("checked")):($("#enabled").prop("checked",!0),$("#tree").treeview("checkNode",[u,{silent:!0}]));break;case"alias":$("#enabled").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]),pushUndo({action:"update",type:g,item:currentNode.dataAttr.index,profile:currentProfile.name,data:{enabled:currentProfile.aliases[currentNode.dataAttr.index].enabled}}),currentProfile.aliases[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked");break;case"macro":$("#enabled").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]),pushUndo({action:"update",type:g,item:currentNode.dataAttr.index,profile:currentProfile.name,data:{enabled:currentProfile.macros[currentNode.dataAttr.index].enabled}}),currentProfile.macros[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked");break;case"trigger":$("#enabled").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]),pushUndo({action:"update",type:g,item:currentNode.dataAttr.index,profile:currentProfile.name,data:{enabled:currentProfile.triggers[currentNode.dataAttr.index].enabled}}),currentProfile.triggers[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked");break;case"button":$("#enabled").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"]),{silent:!0}]),pushUndo({action:"update",type:g,item:currentNode.dataAttr.index,profile:currentProfile.name,data:{enabled:currentProfile.buttons[currentNode.dataAttr.index].enabled}}),currentProfile.buttons[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked");}}exports.UpdateEnabled=UpdateEnabled;function UpdateNode(g){var u=currentNode.state.selected,A={text:GetDisplay(g),id:currentNode.id,dataAttr:{type:currentNode.dataAttr.type,profile:currentNode.dataAttr.profile,index:currentNode.dataAttr.index},state:{checked:g.enabled,selected:currentNode.selected}},v=$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"])[0];if($("#tree").treeview("updateNode",[v,A]),u){var v=$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"])[0];$("#tree").treeview("selectNode",[v,{silent:!0}]),currentNode=v}}exports.UpdateNode=UpdateNode;function getEditorValue(g,u){return editors[g]?(u==profile_1.ItemStyle.Script?editors[g].getSession().setMode("ace/mode/javascript"):editors[g].getSession().setMode("ace/mode/text"),editors[g].getSession().getValue()):$("#"+g).val()}function UpdateMacro(){var g={},u=0,A;currentProfile.macros[currentNode.dataAttr.index].enabled!=$("#enabled").prop("checked")&&(g.enabled=currentProfile.macros[currentNode.dataAttr.index].enabled,u++,currentProfile.macros[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked")),currentProfile.macros[currentNode.dataAttr.index].key!=parseInt($("#MacroKey").data("key"),10)&&(g.key=currentProfile.macros[currentNode.dataAttr.index].key,u++,currentProfile.macros[currentNode.dataAttr.index].key=parseInt($("#MacroKey").data("key"),10)),currentProfile.macros[currentNode.dataAttr.index].modifiers!=parseInt($("#MacroKey").data("mod"),10)&&(g.modifiers=currentProfile.macros[currentNode.dataAttr.index].modifiers,currentProfile.macros[currentNode.dataAttr.index].modifiers=parseInt($("#MacroKey").data("mod"),10),u++),currentProfile.macros[currentNode.dataAttr.index].style!=parseInt($("#MacroStyle").selectpicker("val"),10)&&(g.style=currentProfile.macros[currentNode.dataAttr.index].style,u++,currentProfile.macros[currentNode.dataAttr.index].style=parseInt($("#MacroStyle").selectpicker("val"),10)),A=getEditorValue("MacroValue",currentProfile.macros[currentNode.dataAttr.index].style),A!=currentProfile.macros[currentNode.dataAttr.index].value&&(g.value=currentProfile.macros[currentNode.dataAttr.index].value,u++,currentProfile.macros[currentNode.dataAttr.index].value=A),currentProfile.macros[currentNode.dataAttr.index].name!=$("#MacroName").val()&&(g.name=currentProfile.macros[currentNode.dataAttr.index].name,u++,currentProfile.macros[currentNode.dataAttr.index].name=$("#MacroName").val()),currentProfile.macros[currentNode.dataAttr.index].append!=$("#MacroAppend").prop("checked")&&(g.append=currentProfile.macros[currentNode.dataAttr.index].append,u++,currentProfile.macros[currentNode.dataAttr.index].append=$("#MacroAppend").prop("checked")),currentProfile.macros[currentNode.dataAttr.index].chain!=$("#MacroChain").prop("checked")&&(g.chain=currentProfile.macros[currentNode.dataAttr.index].chain,u++,currentProfile.macros[currentNode.dataAttr.index].chain=$("#MacroChain").prop("checked")),currentProfile.macros[currentNode.dataAttr.index].send!=$("#MacroSend").prop("checked")&&(g.send=currentProfile.macros[currentNode.dataAttr.index].send,u++,currentProfile.macros[currentNode.dataAttr.index].send=$("#MacroSend").prop("checked")),0<u&&(UpdateNode(currentProfile.macros[currentNode.dataAttr.index]),$("#title").text("Macro: "+GetDisplay(currentProfile.macros[currentNode.dataAttr.index])),pushUndo({action:"update",type:"macro",item:currentNode.dataAttr.index,profile:currentProfile.name,data:g}))}exports.UpdateMacro=UpdateMacro;function UpdateAlias(){var g={},u=0,A;currentProfile.aliases[currentNode.dataAttr.index].enabled!=$("#enabled").prop("checked")&&(g.enabled=currentProfile.aliases[currentNode.dataAttr.index].enabled,u++,currentProfile.aliases[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked")),currentProfile.aliases[currentNode.dataAttr.index].pattern!=$("#AliasName").val()&&(g.pattern=currentProfile.aliases[currentNode.dataAttr.index].pattern,u++,currentProfile.aliases[currentNode.dataAttr.index].pattern=$("#AliasName").val()),currentProfile.aliases[currentNode.dataAttr.index].style!=parseInt($("#AliasStyle").selectpicker("val"),10)&&(g.style=currentProfile.aliases[currentNode.dataAttr.index].style,u++,currentProfile.aliases[currentNode.dataAttr.index].style=parseInt($("#AliasStyle").selectpicker("val"),10)),A=getEditorValue("AliasValue",currentProfile.aliases[currentNode.dataAttr.index].style),currentProfile.aliases[currentNode.dataAttr.index].value!=A&&(g.value=currentProfile.aliases[currentNode.dataAttr.index].value,u++,currentProfile.aliases[currentNode.dataAttr.index].value=A),currentProfile.aliases[currentNode.dataAttr.index].params!=$("#AliasParams").val()&&(g.params=currentProfile.aliases[currentNode.dataAttr.index].params,u++,currentProfile.aliases[currentNode.dataAttr.index].params=$("#AliasParams").val()),currentProfile.aliases[currentNode.dataAttr.index].priority!=parseInt($("#AliasPriority").val(),10)&&(g.priority=currentProfile.aliases[currentNode.dataAttr.index].priority,u++,currentProfile.aliases[currentNode.dataAttr.index].priority=parseInt($("#AliasPriority").val(),10)),currentProfile.aliases[currentNode.dataAttr.index].append!=$("#AliasAppend").prop("checked")&&(g.append=currentProfile.aliases[currentNode.dataAttr.index].append,u++,currentProfile.aliases[currentNode.dataAttr.index].append=$("#AliasAppend").prop("checked")),currentProfile.aliases[currentNode.dataAttr.index].multi!=$("#AliasMulti").prop("checked")&&(g.multi=currentProfile.aliases[currentNode.dataAttr.index].multi,u++,currentProfile.aliases[currentNode.dataAttr.index].multi!=$("#AliasMulti").prop("checked")),0<u&&(UpdateNode(currentProfile.aliases[currentNode.dataAttr.index]),$("#title").text("Alias: "+GetDisplay(currentProfile.aliases[currentNode.dataAttr.index])),pushUndo({action:"update",type:"alias",item:currentNode.dataAttr.index,profile:currentProfile.name,data:g}))}exports.UpdateAlias=UpdateAlias;function UpdateTrigger(){var g={},u=0,A;currentProfile.triggers[currentNode.dataAttr.index].enabled!=$("#enabled").prop("checked")&&(g.enabled=currentProfile.triggers[currentNode.dataAttr.index].enabled,u++,currentProfile.triggers[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked")),currentProfile.triggers[currentNode.dataAttr.index].pattern!=$("#TriggerName").val()&&(g.pattern=currentProfile.triggers[currentNode.dataAttr.index].pattern,u++,currentProfile.triggers[currentNode.dataAttr.index].pattern=$("#TriggerName").val()),currentProfile.triggers[currentNode.dataAttr.index].style!=parseInt($("#TriggerStyle").selectpicker("val"),10)&&(g.style=currentProfile.triggers[currentNode.dataAttr.index].style,u++,currentProfile.triggers[currentNode.dataAttr.index].style=parseInt($("#TriggerStyle").selectpicker("val"),10)),A=getEditorValue("TriggerValue",currentProfile.triggers[currentNode.dataAttr.index].style),currentProfile.triggers[currentNode.dataAttr.index].value!=A&&(g.value=currentProfile.triggers[currentNode.dataAttr.index].value,u++,currentProfile.triggers[currentNode.dataAttr.index].value=A),currentProfile.triggers[currentNode.dataAttr.index].priority!=parseInt($("#TriggerPriority").val(),10)&&(g.priority=currentProfile.triggers[currentNode.dataAttr.index].priority,u++,currentProfile.triggers[currentNode.dataAttr.index].priority=parseInt($("#TriggerPriority").val(),10)),$("#TriggerTestText").val(""),$("#TriggerTestResults").val(""),$(".nav-tabs a[href=\"#tvalue\"]").tab("show"),currentProfile.triggers[currentNode.dataAttr.index].verbatim!=$("#TriggerVerbatim").prop("checked")&&(g.verbatim=currentProfile.triggers[currentNode.dataAttr.index].verbatim,u++,currentProfile.triggers[currentNode.dataAttr.index].verbatim=$("#TriggerVerbatim").prop("checked")),currentProfile.triggers[currentNode.dataAttr.index].triggerNewline!=$("#TriggerNewline").prop("checked")&&(g.triggerNewline=currentProfile.triggers[currentNode.dataAttr.index].triggerNewline,u++,currentProfile.triggers[currentNode.dataAttr.index].triggerNewline=$("#TriggerNewline").prop("checked")),currentProfile.triggers[currentNode.dataAttr.index].triggerPrompt!=$("#TriggerPrompt").prop("checked")&&(g.triggerPrompt=currentProfile.triggers[currentNode.dataAttr.index].triggerPrompt,u++,currentProfile.triggers[currentNode.dataAttr.index].triggerPrompt=$("#TriggerPrompt").prop("checked")),currentProfile.triggers[currentNode.dataAttr.index].type!=parseInt($("#TriggerType").selectpicker("val"),10)&&(g.type=currentProfile.triggers[currentNode.dataAttr.index].type,u++,currentProfile.triggers[currentNode.dataAttr.index].type=parseInt($("#TriggerType").selectpicker("val"),10)),0<u&&(UpdateNode(currentProfile.triggers[currentNode.dataAttr.index]),$("#title").text("Trigger: "+GetDisplay(currentProfile.triggers[currentNode.dataAttr.index])),pushUndo({action:"update",type:"trigger",item:currentNode.dataAttr.index,profile:currentProfile.name,data:g}))}exports.UpdateTrigger=UpdateTrigger;function UpdateButton(){var g={},u=0,A;currentProfile.buttons[currentNode.dataAttr.index].enabled!=$("#enabled").prop("checked")&&(g.enabled=currentProfile.buttons[currentNode.dataAttr.index].enabled,u++,currentProfile.buttons[currentNode.dataAttr.index].enabled=$("#enabled").prop("checked")),currentProfile.buttons[currentNode.dataAttr.index].caption!=$("#ButtonCaption").val()&&(g.caption=currentProfile.buttons[currentNode.dataAttr.index].caption,u++,currentProfile.buttons[currentNode.dataAttr.index].caption=$("#ButtonCaption").val()),currentProfile.buttons[currentNode.dataAttr.index].icon!=$("#ButtonIcon").val()&&(g.icon=currentProfile.buttons[currentNode.dataAttr.index].icon,u++,currentProfile.buttons[currentNode.dataAttr.index].icon=$("#ButtonIcon").val()),currentProfile.buttons[currentNode.dataAttr.index].style!=parseInt($("#ButtonStyle").selectpicker("val"),10)&&(g.style=currentProfile.buttons[currentNode.dataAttr.index].style,u++,currentProfile.buttons[currentNode.dataAttr.index].style=parseInt($("#ButtonStyle").selectpicker("val"),10)),A=getEditorValue("ButtonValue",currentProfile.buttons[currentNode.dataAttr.index].style),currentProfile.buttons[currentNode.dataAttr.index].value!=A&&(g.value=currentProfile.buttons[currentNode.dataAttr.index].value,u++,currentProfile.buttons[currentNode.dataAttr.index].value=A),currentProfile.buttons[currentNode.dataAttr.index].name!=$("#ButtonName").val()&&(g.name=currentProfile.buttons[currentNode.dataAttr.index].name,u++,currentProfile.buttons[currentNode.dataAttr.index].name=$("#ButtonName").val()),currentProfile.buttons[currentNode.dataAttr.index].priority!=parseInt($("#ButtonPriority").val(),10)&&(g.priority=currentProfile.buttons[currentNode.dataAttr.index].priority,u++,currentProfile.buttons[currentNode.dataAttr.index].priority=parseInt($("#ButtonPriority").val(),10)),currentProfile.buttons[currentNode.dataAttr.index].send!=$("#ButtonSend").prop("checked")&&(g.send=currentProfile.buttons[currentNode.dataAttr.index].send,u++,currentProfile.buttons[currentNode.dataAttr.index].send=$("#ButtonSend").prop("checked")),currentProfile.buttons[currentNode.dataAttr.index].append!=$("#ButtonAppend").prop("checked")&&(g.append=currentProfile.buttons[currentNode.dataAttr.index].append,u++,currentProfile.buttons[currentNode.dataAttr.index].append=$("#ButtonAppend").prop("checked")),currentProfile.buttons[currentNode.dataAttr.index].chain!=$("#ButtonChain").prop("checked")&&(g.chain=currentProfile.buttons[currentNode.dataAttr.index].chain,u++,currentProfile.buttons[currentNode.dataAttr.index].chain=$("#ButtonChain").prop("checked")),currentProfile.buttons[currentNode.dataAttr.index].stretch!=$("#ButtonStretch").prop("checked")&&(g.stretch=currentProfile.buttons[currentNode.dataAttr.index].stretch,u++,currentProfile.buttons[currentNode.dataAttr.index].stretch=$("#ButtonStretch").prop("checked")),0<u&&(UpdateButtonSample(),UpdateNode(currentProfile.buttons[currentNode.dataAttr.index]),$("#title").text("Button: "+GetDisplay(currentProfile.buttons[currentNode.dataAttr.index])),pushUndo({action:"update",type:"button",item:currentNode.dataAttr.index,profile:currentProfile.name,data:g}))}exports.UpdateButton=UpdateButton;function UpdateProfile(){var A,g={},u=0,A=$("#ProfileName").val();if(A!=currentProfile.name){if(g.name=A,u++,profiles.contains(A))return dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"error",title:"Profile name already used",message:"The name is already in use, pick a different one"}),$("#ProfileName").val(currentProfile.name),void $("#ProfileName").focus();profiles.remove(currentProfile),currentProfile.name=A,profiles.add(currentProfile),$("#title").text("Profile: "+currentProfile.name);var v=currentNode.state.selected,w=currentNode.state.expanded,N={text:A,id:"Profile"+profileID(A),state:{checked:currentProfile.enabled,expanded:currentNode.state.expanded},dataAttr:{type:"profile",profile:A},nodes:[{text:"Aliases",id:"Profile"+profileID(A)+"aliases",dataAttr:{profile:A},lazyLoad:0<currentProfile.aliases.length,state:{checked:currentProfile.enableAliases}},{text:"Macros",id:"Profile"+profileID(A)+"macros",dataAttr:{profile:A},lazyLoad:0<currentProfile.macros.length,state:{checked:currentProfile.enableMacros}},{text:"Triggers",id:"Profile"+profileID(A)+"triggers",dataAttr:{profile:A},lazyLoad:0<currentProfile.triggers.length,state:{checked:currentProfile.enableTriggers}},{text:"Buttons",id:"Profile"+profileID(A)+"buttons",dataAttr:{profile:A},lazyLoad:0<currentProfile.buttons.length,state:{checked:currentProfile.enableButtons}}]},P=$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"])[0];if($("#tree").treeview("updateNode",[P,N]),v){var P=$("#tree").treeview("findNodes",["^Profile"+A+"$","id"])[0];$("#tree").treeview("selectNode",[P,{silent:!0}]),currentNode=P}}return currentProfile.enableAliases!=$("#enableAliases").prop("checked")&&(g.enableAliases=currentProfile.enableAliases,u++,currentProfile.enableAliases=$("#enableAliases").prop("checked")),currentProfile.enableMacros!=$("#enableMacros").prop("checked")&&(g.enableMacros=currentProfile.enableMacros,u++,currentProfile.enableMacros=$("#enableMacros").prop("checked")),currentProfile.enableTriggers!=$("#enableTriggers").prop("checked")&&(g.enableTriggers=currentProfile.enableTriggers,u++,currentProfile.enableTriggers=$("#enableTriggers").prop("checked")),currentProfile.enableButtons!=$("#enableButtons").prop("checked")&&(g.enableButtons=currentProfile.enableButtons,u++,currentProfile.enableButtons=$("#enableButtons").prop("checked")),currentProfile.enabled!=$("#enabled").prop("checked")&&(g.enabled=currentProfile.enabled,u++,$("#enabled").prop("checked")?currentProfile.enabled=!0:profiles.canDisable(currentProfile)?currentProfile.enabled=!1:($("#enabled").prop("checked",!0),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+currentNode.id+"$","id"])]))),currentProfile.priority!=parseInt($("#profilePriority").val(),10)&&(g.priority=currentProfile.priority,u++,currentProfile.priority=parseInt($("#profilePriority").val(),10)),A=profileID(currentProfile.name),currentProfile.enableAliases?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+A+"aliases$","id"])]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+A+"aliases$","id"])]),currentProfile.enableMacros?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+A+"macros$","id"])]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+A+"macros$","id"])]),currentProfile.enableTriggers?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+A+"triggers$","id"])]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+A+"triggers$","id"])]),currentProfile.enableButtons?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+A+"buttons$","id"])]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+A+"buttons$","id"])]),0<u&&pushUndo({action:"update",type:"profile",profile:currentProfile.name,data:g}),!0}exports.UpdateProfile=UpdateProfile;function updateProfileChecks(){_pUndo=!0;var g=profileID(currentProfile.name);$("#enableAliases").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+g+"aliases$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+g+"aliases$","id"]),{silent:!0}]),$("#enableMacros").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+g+"macros$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+g+"macros$","id"]),{silent:!0}]),$("#enableTriggers").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+g+"triggers$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+g+"triggers$","id"]),{silent:!0}]),$("#enableButtons").prop("checked")?$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+g+"buttons$","id"]),{silent:!0}]):$("#tree").treeview("uncheckNode",[$("#tree").treeview("findNodes",["^Profile"+g+"buttons$","id"]),{silent:!0}]),_pUndo=!1}exports.updateProfileChecks=updateProfileChecks;function nodeCheckChanged(g,u){var A=1,v={};if(u){var w="profile";w=u.dataAttr.type?u.dataAttr.type:$("#tree").treeview("getParents",u)[0].dataAttr.type;var N=profiles.items[u.dataAttr.profile];switch(w){case"profile":switch(u.text.toLowerCase()){case"aliases":v.enableAliases=u.state.checked,N.enableAliases=u.state.checked,N==currentProfile&&$("#enableAliases").prop("checked",u.state.checked);break;case"macros":v.enableMacros=u.state.checked,N.enableMacros=u.state.checked,N==currentProfile&&$("#enableMacros").prop("checked",u.state.checked);break;case"triggers":v.enableTriggers=u.state.checked,N.enableTriggers=u.state.checked,N==currentProfile&&$("#enableTriggers").prop("checked",u.state.checked);break;case"buttons":v.enableButtons=u.state.checked,N.enableButtons=u.state.checked,N==currentProfile&&$("#enableButtons").prop("checked",u.state.checked);break;default:u.state.checked?N.enabled==u.state.checked?A=0:N.enabled=u.state.checked:profiles.canDisable(N)?N.enabled=u.state.checked:($("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^"+u.id+"$","id"]),{silent:!0}]),A=0),v.enabled=N.enabled,N==currentProfile&&$("#enabled").prop("checked",N.enabled);}break;case"aliases":N.enableAliases=u.state.checked,w="profile",v.enableAliases=u.state.checked,N==currentProfile&&$("#enableAliases").prop("checked",u.state.checked);break;case"macros":N.enableMacros=u.state.checked,w="profile",v.enableMacros=u.state.checked,N==currentProfile&&$("#enableMacros").prop("checked",u.state.checked);break;case"triggers":N.enableTriggers=u.state.checked,w="profile",v.enableTriggers=u.state.checked,N==currentProfile&&$("#enableTriggers").prop("checked",u.state.checked);break;case"buttons":N.enableButtons=u.state.checked,w="profile",v.enableButtons=u.state.checked,N==currentProfile&&$("#enableButtons").prop("checked",u.state.checked);break;case"alias":N.aliases[u.dataAttr.index].enabled=u.state.checked,v.enabled=u.state.checked,u.id==currentNode.id&&$("#enabled").prop("checked",u.state.checked);break;case"macro":N.macros[u.dataAttr.index].enabled=u.state.checked,v.enabled=u.state.checked,u.id==currentNode.id&&$("#enabled").prop("checked",u.state.checked);break;case"trigger":N.triggers[u.dataAttr.index].enabled=u.state.checked,v.enabled=u.state.checked,u.id==currentNode.id&&$("#enabled").prop("checked",u.state.checked);break;case"button":N.buttons[u.dataAttr.index].enabled=u.state.checked,v.enabled=u.state.checked,u.id==currentNode.id&&$("#enabled").prop("checked",u.state.checked);}0<A&&pushUndo({action:"update",type:w,profile:N.name,data:v})}}function resetClip(){if(_clip&&0<_clip.data.length&&2==_clip.action)for(var A,g=0,u=_clip.data.length;g<u;g++)A=$("#tree").treeview("findNodes",["^Profile"+profileID(_clip.profile)+_clip.key+_clip.data[g],"id"]),A[0].$el.css("opacity","");_clip=0}function canPaste(){if(_clip)if(1===_clip.data.length&&"macro"==_clip.type){var g=library_1.FilterArrayByKeyValue(currentProfile.macros,"key",_clip.data[0].key);if(g=library_1.FilterArrayByKeyValue(g,"modifiers",_clip.data[0].modifiers),0==g.length)return!0}else return!0;return!1}function UpdatePaste(){$("#btnPaste").prop("disabled",!canPaste())}exports.UpdatePaste=UpdatePaste;function doUndo(){}exports.doUndo=doUndo;function doRedo(){}exports.doRedo=doRedo;function doCut(g){var u;if(g||(g=currentNode,!!g)){resetClip();var w,A=profiles.items[g.dataAttr.profile],v="profile";switch(v=g.dataAttr.type?g.dataAttr.type:g.text.toLowerCase(),v){case"aliases":u=[];for(var N=0,P=A.aliases.length;N<P;N++)u.push(N);_clip={type:"alias",data:u,key:"aliases"},w=$("#tree").treeview("findNodes",["^"+g.id+"[0-9]+","id"]);for(var T=0,M=w.length;T<M;T++)w[T].$el.css("opacity","0.5");break;case"alias":_clip={type:v,data:[g.dataAttr.index],key:"aliases",idx:g.dataAttr.index},g.$el.css("opacity","0.5");break;case"macros":u=[];for(var N=0,P=A.macros.length;N<P;N++)u.push(N);_clip={type:"macro",data:u,key:"macros"},w=$("#tree").treeview("findNodes",["^"+g.id+"[0-9]+","id"]);for(var T=0,M=w.length;T<M;T++)w[T].$el.css("opacity","0.5");break;case"macro":_clip={type:v,data:[g.dataAttr.index],key:"macros",idx:g.dataAttr.index},g.$el.css("opacity","0.5");break;case"triggers":u=[];for(var N=0,P=A.triggers.length;N<P;N++)u.push(N);_clip={type:"trigger",data:u,key:"triggers"},w=$("#tree").treeview("findNodes",["^"+g.id+"[0-9]+","id"]);for(var T=0,M=w.length;T<M;T++)w[T].$el.css("opacity","0.5");break;case"trigger":_clip={type:v,data:[g.dataAttr.index],key:"triggers",idx:g.dataAttr.index},g.$el.css("opacity","0.5");break;case"buttons":u=[];for(var N=0,P=A.buttons.length;N<P;N++)u.push(N);_clip={type:"button",data:u,key:"buttons"},w=$("#tree").treeview("findNodes",["^"+g.id+"[0-9]+","id"]);for(var T=0,M=w.length;T<M;T++)w[T].$el.css("opacity","0.5");break;case"button":_clip={type:v,data:[g.dataAttr.index],key:"buttons",idx:g.dataAttr.index},g.$el.css("opacity","0.5");}_clip&&(_clip.profile=A.name.toLowerCase(),_clip.action=2),UpdatePaste()}}exports.doCut=doCut;function doCopy(g){var u;if(g||(g=currentNode,!!g)){resetClip();var A="profile",w=profiles.items[g.dataAttr.profile];switch(A=g.dataAttr.type?g.dataAttr.type:g.text.toLowerCase(),A){case"profile":w=w.clone(),w.name=profileCopyName(w.name),profiles.add(w);var N=w.name,P=w.name.toLowerCase();g={text:N,id:"Profile"+profileID(P),state:{checked:w.enabled},dataAttr:{type:"profile",profile:P},nodes:[{text:"Aliases",id:"Profile"+profileID(P)+"aliases",dataAttr:{profile:P},lazyLoad:0<w.aliases.length,state:{checked:w.enableAliases}},{text:"Macros",id:"Profile"+profileID(P)+"macros",dataAttr:{profile:P},lazyLoad:0<w.macros.length,state:{checked:w.enableMacros}},{text:"Triggers",id:"Profile"+profileID(P)+"triggers",dataAttr:{profile:P},lazyLoad:0<w.triggers.length,state:{checked:w.enableTriggers}},{text:"Buttons",id:"Profile"+profileID(P)+"buttons",dataAttr:{profile:P},lazyLoad:0<w.buttons.length,state:{checked:w.enableButtons}}]},$("#tree").treeview("addNode",[g,!1,!1]),pushUndo({action:"add",type:"profile",item:[P]});break;case"aliases":u=[];for(var T=0,M=w.aliases.length;T<M;T++)u.push(w.aliases[T].clone());_clip={type:"alias",data:u,key:"aliases"};break;case"alias":_clip={type:A,data:[w.aliases[g.dataAttr.index].clone()],key:"aliases",idx:g.dataAttr.index};break;case"macros":u=[];for(var T=0,M=w.macros.length;T<M;T++)u.push(w.macros[T].clone());_clip={type:"macro",data:u,key:"macros"};break;case"macro":_clip={type:A,data:[w.macros[g.dataAttr.index].clone()],key:"macros",idx:g.dataAttr.index};break;case"triggers":u=[];for(var T=0,M=w.triggers.length;T<M;T++)u.push(w.triggers[T].clone());_clip={type:"trigger",data:u,key:"triggers"};break;case"trigger":_clip={type:A,data:[w.triggers[g.dataAttr.index].clone()],key:"triggers",idx:g.dataAttr.index};break;case"buttons":u=[];for(var T=0,M=w.buttons.length;T<M;T++)u.push(w.buttons[T].clone());_clip={type:"button",data:u,key:"buttons"};break;case"button":_clip={type:A,data:[w.buttons[g.dataAttr.index].clone()],key:"buttons",idx:g.dataAttr.index};}_clip&&(_clip.profile=w.name.toLowerCase(),_clip.action=1),UpdatePaste()}}exports.doCopy=doCopy;function doPaste(g){if(_clip&&0!=_clip.data.length&&(g||(g=currentNode,!!g))){for(var w,u={action:"group",add:[],delete:[]},A=profiles.items[g.dataAttr.profile],v=profiles.items[_clip.profile],N=0,P=_clip.data.length;N<P;N++)w=1==_clip.action?_clip.data[N].clone():v[_clip.key][_clip.data[N]].clone(),u.add.push({type:_clip.type,item:w.clone(),data:{type:_clip.type,key:_clip.key,item:w.clone(),id:A[_clip.key].length,profile:A.name.toLowerCase()}}),addItem(_clip.type,_clip.key,w,A[_clip.key].length,A,!0);if(2==_clip.action){for(var N=0,P=_clip.data.length;N<P;N++)w=v[_clip.key][_clip.data[N]].clone(),u.delete.push({type:_clip.type,item:w.clone(),data:{type:_clip.type,key:_clip.key,item:w,id:_clip.data[N],profile:v.name.toLowerCase()}}),DeleteItem(_clip.type,_clip.key,_clip.data[N],v,!0);_clip=0,UpdatePaste()}pushUndo(u)}}exports.doPaste=doPaste;function doDelete(g){var u;(g||(g=currentNode,!!g))&&(resetClip(),g.state.selected=!1,u="profile",u=g.dataAttr.type?g.dataAttr.type:g.text.toLowerCase(),"profile"===u?DeleteProfileConfirm(profiles.items[g.dataAttr.profile]):"aliases"===u?DeleteItems("alias","aliases",profiles.items[g.dataAttr.profile]):"alias"===u?DeleteItemConfirm("alias","aliases",g.dataAttr.index,profiles.items[g.dataAttr.profile]):"macros"===u?DeleteItems("macro","macros",profiles.items[g.dataAttr.profile]):"macro"===u?DeleteItemConfirm("macro","macros",g.dataAttr.index,profiles.items[g.dataAttr.profile]):"triggers"===u?DeleteItems("trigger","triggers",profiles.items[g.dataAttr.profile]):"trigger"===u?DeleteItemConfirm("trigger","triggers",g.dataAttr.index,profiles.items[g.dataAttr.profile]):"buttons"===u?DeleteItems("button","buttons",profiles.items[g.dataAttr.profile]):"button"===u?DeleteItemConfirm("button","buttons",g.dataAttr.index,profiles.items[g.dataAttr.profile]):void 0)}exports.doDelete=doDelete;function updateCurrent(){if(currentNode){currentNode.state.selected=!1;var g="profile";switch(g=currentNode.dataAttr.type?currentNode.dataAttr.type:$("#tree").treeview("getParents",currentNode)[0].dataAttr.type,g){case"aliases":case"macros":case"triggers":case"buttons":case"profile":return UpdateProfile();case"alias":UpdateAlias();break;case"macro":UpdateMacro();break;case"trigger":UpdateTrigger();break;case"button":UpdateButton();}}return!0}exports.updateCurrent=updateCurrent;function buildTreeview(g){currentNode=0,$("#tree").treeview({showBorder:!1,showImage:!0,showTags:!0,showCheckbox:!0,preventUnselect:!0,levels:1,checkedIcon:"fa fa-check-square-o",uncheckedIcon:"fa fa-square-o",expandIcon:"fa fa-chevron-right",collapseIcon:"fa fa-chevron-down",onNodeRendered:function(u,A){A.$el.prop("title",A.text)},onNodeUnchecked:nodeCheckChanged,onNodeChecked:nodeCheckChanged,onNodeSelected:function(u,A){var v;if(!updateCurrent())return void $("#tree").treeview("selectNode",[currentNode,{silent:!0}]);A&&(v="profile",v=A.dataAttr.type?A.dataAttr.type:$("#tree").treeview("getParents",A)[0].dataAttr.type,currentNode=A,currentProfile=profiles.items[A.dataAttr.profile],UpdatePaste(),$("#profile").css("display","none"),$("#aliases").css("display","none"),$("#macros").css("display","none"),$("#triggers").css("display","none"),$("#buttons").css("display","none"),$("#btnCut").prop("disabled",!1),$("#btnCopy").prop("disabled",!1),$("#btnDelete").prop("disabled",!1),UpdatePaste(),"aliases"===v||"macros"===v||"triggers"===v||"buttons"===v||"profile"===v?($("#profile").css("display",""),$("#title").text("Profile: "+currentProfile.name),$("#ProfileName").val(currentProfile.name),"Default"==currentProfile.name?($("#ProfileName").prop("disabled",!0),"profile"==v&&($("#btnCut").prop("disabled",!0),$("#btnDelete").prop("disabled",!0))):$("#ProfileName").prop("disabled",!1),"profile"!=v&&0==currentProfile[v].length?($("#btnCopy").prop("disabled",!0),$("#btnCut").prop("disabled",!0),$("#btnDelete").prop("disabled",!0)):"profile"==v&&$("#btnCut").prop("disabled",!0),$("#enableAliases").prop("checked",currentProfile.enableAliases),$("#enableMacros").prop("checked",currentProfile.enableMacros),$("#enableTriggers").prop("checked",currentProfile.enableTriggers),$("#enableButtons").prop("checked",currentProfile.enableButtons),$("#enabled").prop("checked",currentProfile.enabled),$("#profilePriority").val(currentProfile.priority)):"alias"===v?($("#aliases").css("display",""),$("#title").text("Alias: "+A.text),$("#enabled").prop("checked",currentProfile.aliases[A.dataAttr.index].enabled),$("#AliasName").val(currentProfile.aliases[A.dataAttr.index].pattern),$("#AliasStyle").selectpicker("val",currentProfile.aliases[A.dataAttr.index].style),editors.AliasValue&&(editors.AliasValue.getSession().setValue(currentProfile.aliases[A.dataAttr.index].value),currentProfile.aliases[currentNode.dataAttr.index].style==profile_1.ItemStyle.Script?editors.AliasValue.getSession().setMode("ace/mode/javascript"):editors.AliasValue.getSession().setMode("ace/mode/text")),$("#AliasValue").val(currentProfile.aliases[A.dataAttr.index].value),$("#AliasParams").val(currentProfile.aliases[A.dataAttr.index].params),$("#AliasPriority").val(currentProfile.aliases[A.dataAttr.index].priority),$("#AliasAppend").prop("checked",currentProfile.aliases[A.dataAttr.index].append),$("#AliasMulti").prop("checked",currentProfile.aliases[A.dataAttr.index].multi)):"macro"===v?($("#macros").css("display",""),$("#title").text("Macro: "+A.text),$("#enabled").prop("checked",currentProfile.macros[A.dataAttr.index].enabled),$("#MacroKey").val(MacroeKeys(currentProfile.macros[A.dataAttr.index])),$("#MacroKey").data("key",currentProfile.macros[A.dataAttr.index].key),$("#MacroKey").data("mod",currentProfile.macros[A.dataAttr.index].modifiers),$("#MacroStyle").selectpicker("val",currentProfile.macros[A.dataAttr.index].style),editors.MacroValue&&(editors.MacroValue.getSession().setValue(currentProfile.macros[A.dataAttr.index].value),currentProfile.macros[currentNode.dataAttr.index].style==profile_1.ItemStyle.Script?editors.MacroValue.getSession().setMode("ace/mode/javascript"):editors.MacroValue.getSession().setMode("ace/mode/text")),$("#MacroValue").val(currentProfile.macros[A.dataAttr.index].value),$("#MacroName").val(currentProfile.macros[A.dataAttr.index].name),$("#MacroAppend").prop("checked",currentProfile.macros[A.dataAttr.index].append),$("#MacroChain").prop("checked",currentProfile.macros[A.dataAttr.index].chain),$("#MacroSend").prop("checked",currentProfile.macros[A.dataAttr.index].send)):"trigger"===v?($("#triggers").css("display",""),$("#title").text("Trigger: "+A.text),$("#enabled").prop("checked",currentProfile.triggers[A.dataAttr.index].enabled),$("#TriggerName").val(currentProfile.triggers[A.dataAttr.index].pattern),$("#TriggerStyle").selectpicker("val",currentProfile.triggers[A.dataAttr.index].style),editors.TriggerValue&&(editors.TriggerValue.getSession().setValue(currentProfile.triggers[A.dataAttr.index].value),currentProfile.triggers[currentNode.dataAttr.index].style==profile_1.ItemStyle.Script?editors.TriggerValue.getSession().setMode("ace/mode/javascript"):editors.TriggerValue.getSession().setMode("ace/mode/text")),$("#TriggerValue").val(currentProfile.triggers[A.dataAttr.index].value),$("#TriggerPriority").val(currentProfile.triggers[A.dataAttr.index].priority),$("#TriggerTestText").val(""),$("#TriggerTestResults").val(""),$(".nav-tabs a[href=\"#tvalue\"]").tab("show"),$("#TriggerVerbatim").prop("checked",currentProfile.triggers[A.dataAttr.index].verbatim),$("#TriggerNewline").prop("checked",currentProfile.triggers[A.dataAttr.index].triggerNewline),$("#TriggerPrompt").prop("checked",currentProfile.triggers[A.dataAttr.index].triggerPrompt),$("#TriggerType").selectpicker("val",currentProfile.triggers[A.dataAttr.index].type)):"button"===v?($("#buttons").css("display",""),$("#title").text("Button: "+A.text),$("#enabled").prop("checked",currentProfile.buttons[A.dataAttr.index].enabled),$("#ButtonCaption").val(currentProfile.buttons[A.dataAttr.index].caption),$("#ButtonIcon").val(currentProfile.buttons[A.dataAttr.index].icon),$("#ButtonStyle").selectpicker("val",currentProfile.buttons[A.dataAttr.index].style),editors.ButtonValue&&(editors.ButtonValue.getSession().setValue(currentProfile.buttons[A.dataAttr.index].value),currentProfile.buttons[currentNode.dataAttr.index].style==profile_1.ItemStyle.Script?editors.ButtonValue.getSession().setMode("ace/mode/javascript"):editors.ButtonValue.getSession().setMode("ace/mode/text")),$("#ButtonValue").val(currentProfile.buttons[A.dataAttr.index].value),$("#ButtonName").val(currentProfile.buttons[A.dataAttr.index].name),$("#ButtonPriority").val(currentProfile.buttons[A.dataAttr.index].priority),$("#ButtonSend").prop("checked",currentProfile.buttons[A.dataAttr.index].send),$("#ButtonAppend").prop("checked",currentProfile.buttons[A.dataAttr.index].append),$("#ButtonChain").prop("checked",currentProfile.buttons[A.dataAttr.index].chain),$("#ButtonStretch").prop("checked",currentProfile.buttons[A.dataAttr.index].stretch),UpdateButtonSample()):void 0)},onNodeUnselected:function(){},lazyLoad:function(u,A){var N,P,T,M,v=$("#tree").treeview("getParents",u)[0],w=[],C=profiles.items[v.dataAttr.profile][u.text.toLowerCase()].length;for(T="Aliases"==u.text?"alias":u.text.substr(0,u.text.length-1).toLowerCase(),M=0;M<C;M++)N=profiles.items[v.dataAttr.profile][u.text.toLowerCase()][M],P={text:GetDisplay(N),id:v.id+profileID(u.text)+M,dataAttr:{type:T,profile:v.dataAttr.profile.toLowerCase(),index:M},state:{checked:N.enabled}},w.push(P);if(A(w),_clip&&2==_clip.action&&_clip.key==u.text.toLowerCase())for(M=0,C=_clip.data.length;M<C;M++)P=$("#tree").treeview("findNodes",["^"+u.id+M,"id"]),P[0].$el.css("opacity","0.5")},data:g,onInitialized:function(u,A){var A=$("#tree").treeview("findNodes",["Default","text"]);currentNode||($("#tree").treeview("expandNode",[A]),$("#tree").treeview("selectNode",[A]))}})}function getProfileData(){var g=[{text:"Default",id:"Profiledefault",state:{checked:profiles.items["default"].enabled},dataAttr:{type:"profile",profile:"default"},nodes:[{text:"Aliases",id:"Profiledefaultaliases",dataAttr:{profile:"default",type:"aliases"},lazyLoad:0<profiles.items["default"].aliases.length,state:{checked:profiles.items["default"].enableAliases}},{text:"Macros",id:"Profiledefaultmacros",dataAttr:{profile:"default",type:"macros"},lazyLoad:0<profiles.items["default"].macros.length,state:{checked:profiles.items["default"].enableMacros}},{text:"Triggers",id:"Profiledefaulttriggers",dataAttr:{profile:"default",type:"triggers"},lazyLoad:0<profiles.items["default"].triggers.length,state:{checked:profiles.items["default"].enableTriggers}},{text:"Buttons",id:"Profiledefaultbuttons",dataAttr:{profile:"default",type:"buttons"},lazyLoad:0<profiles.items["default"].buttons.length,state:{checked:profiles.items["default"].enableButtons}}]}];for(var u in profiles.items)if("default"!=u){var A={text:u,id:"Profile"+profileID(u),dataAttr:{type:"profile",profile:u},state:{checked:profiles.items[u].enabled},nodes:[{text:"Aliases",id:"Profile"+profileID(u)+"aliases",dataAttr:{profile:u,type:"aliases"},lazyLoad:0<profiles.items[u].aliases.length,state:{checked:profiles.items[u].enableAliases}},{text:"Macros",id:"Profile"+profileID(u)+"macros",dataAttr:{profile:u,type:"macros"},lazyLoad:0<profiles.items[u].macros.length,state:{checked:profiles.items[u].enableMacros}},{text:"Triggers",id:"Profile"+profileID(u)+"triggers",dataAttr:{profile:u,type:"triggers"},lazyLoad:0<profiles.items[u].triggers.length,state:{checked:profiles.items[u].enableTriggers}},{text:"Buttons",id:"Profile"+profileID(u)+"buttons",dataAttr:{profile:u,type:"buttons"},lazyLoad:0<profiles.items[u].buttons.length,state:{checked:profiles.items[u].enableButtons}}]};g.push(A)}return g}function init(){$(document).ready(()=>{var g=settings_1.Settings.load(path.join(library_1.parseTemplate("{data}"),"settings.json"));_never=g.profiles.askoncancel;var u=path.join(library_1.parseTemplate("{data}"),"profiles");fs.existsSync(u)?(profiles.load(u),!profiles.contains("default")&&profiles.add(profile_1.Profile.Default),watcher=fs.watch(u,()=>{fchanged=!0,$("#btnRefresh").addClass("btn-warning")})):profiles.add(profile_1.Profile.Default),buildTreeview(getProfileData()),$("#tree").contextmenu((A)=>{var v=$(A.target).closest("li.list-group-item").attr("data-nodeId"),w=$("#tree").treeview("findNodes",["^"+v+"$","nodeId"]),N=new Menu;if(!w||0==w.length)N.append(new MenuItem({label:"Add empty profile",click(){AddProfile()}})),N.append(new MenuItem({label:"Add profile with defaults",click(){AddProfile(!0)}}));else{var P="profile";P=w[0].dataAttr.type?w[0].dataAttr.type:$("#tree").treeview("getParents",w[0])[0].dataAttr.type;var T=profiles.items[w[0].dataAttr.profile];"profile"==P?(N.append(new MenuItem({label:"Add empty profile",click(){AddProfile()}})),N.append(new MenuItem({label:"Add profile with defaults",click(){AddProfile(!0)}})),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Copy",click(){doCopy(w[0])}})),canPaste()&&N.append(new MenuItem({label:"Paste",click(){doPaste(w[0])}})),"Default"!=T.name&&(N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Delete",click(){doDelete(w[0])}}))),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Import defaults",click(){doImport(w[0])}})),N.append(new MenuItem({label:"Reset",click(){doReset(w[0])}}))):"aliases"==P||"alias"==P?(N.append(new MenuItem({label:"Add alias",click(){addItem("Alias","aliases",new profile_1.Alias)}})),0<T.aliases.length&&(N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Cut",click(){doCut(w[0])}})),N.append(new MenuItem({label:"Copy",click(){doCopy(w[0])}})),canPaste()&&N.append(new MenuItem({label:"Paste",click(){doPaste(w[0])}})),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Delete",click(){doDelete(w[0])}})))):"macros"==P||"macro"==P?(N.append(new MenuItem({label:"Add macro",click(){addItem("Macro","macros",new profile_1.Macro)}})),0<T.macros.length&&(N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Cut",click(){doCut(w[0])}})),N.append(new MenuItem({label:"Copy",click(){doCopy(w[0])}})),canPaste()&&N.append(new MenuItem({label:"Paste",click(){doPaste(w[0])}})),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Delete",click(){doDelete(w[0])}})))):"triggers"==P||"trigger"==P?(N.append(new MenuItem({label:"Add trigger",click(){addItem("Trigger","triggers",new profile_1.Trigger)}})),0<T.triggers.length&&(N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Cut",click(){doCut(w[0])}})),N.append(new MenuItem({label:"Copy",click(){doCopy(w[0])}})),canPaste()&&N.append(new MenuItem({label:"Paste",click(){doPaste(w[0])}})),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Delete",click(){doDelete(w[0])}})))):"buttons"==P||"button"==P?(N.append(new MenuItem({label:"Add button",click(){addItem("Button","buttons",new profile_1.Button)}})),0<T.buttons.length&&(N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Cut",click(){doCut(w[0])}})),N.append(new MenuItem({label:"Copy",click(){doCopy(w[0])}})),canPaste()&&N.append(new MenuItem({label:"Paste",click(){doPaste(w[0])}})),N.append(new MenuItem({type:"separator"})),N.append(new MenuItem({label:"Delete",click(){doDelete(w[0])}})))):void 0}N.popup(electron_1.remote.getCurrentWindow())}),$("#dragbar").mousedown(function(A){A.preventDefault(),dragging=!0;var v=$("#editor"),w=$("<div>",{id:"ghostbar",css:{height:v.outerHeight(),top:v.offset().top,left:v.offset().left-3}}).appendTo("body");$(document).mousemove(function(N){199>N.pageX?w.css("left",199):N.pageX>document.body.clientWidth-300?w.css("left",document.body.clientWidth-300):w.css("left",N.pageX)})}),$(window).on("resize",()=>{300>$("#editor").outerWidth()&&202<$("#sidebar").outerWidth()&&($("#sidebar").css("width",document.body.clientWidth-300),$("#editor").css("left",document.body.clientWidth-300),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"split",value:document.body.clientWidth-300}))}),$(document).mouseup(function(A){dragging&&(200>A.pageX?($("#sidebar").css("width",202),$("#editor").css("left",202),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"split",value:202})):A.pageX>document.body.clientWidth-200?($("#sidebar").css("width",document.body.clientWidth-300),$("#editor").css("left",document.body.clientWidth-300),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"split",value:document.body.clientWidth-300})):($("#sidebar").css("width",A.pageX+2),$("#editor").css("left",A.pageX+2),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"split",value:A.pageX+2})),$("#ghostbar").remove(),$(document).unbind("mousemove"),dragging=!1)}),200<g.profiles.split&&($("#sidebar").css("width",g.profiles.split),$("#editor").css("left",g.profiles.split)),$("#addMenu").click(function(){$(this).addClass("open");var A=$(this).offset(),v=_Mathfloor(A.left),w=_Mathfloor(A.top+$(this).outerHeight()+2);addmenu.popup(electron_1.remote.getCurrentWindow(),v,w)}),$("#MacroKey").keydown(function(A){return A.preventDefault(),A.stopPropagation(),!1}),$("#MacroKey").keypress(function(A){return A.preventDefault(),A.stopPropagation(),!1}),$("#MacroKey").keyup(function(A){A.preventDefault(),A.stopPropagation();var v=[],w=profile_1.MacroModifiers.None;if(A.ctrlKey&&(v.push("Ctrl"),w|=profile_1.MacroModifiers.Ctrl),A.altKey&&(v.push("Alt"),w|=profile_1.MacroModifiers.Alt),A.shiftKey&&(v.push("Shift"),w|=profile_1.MacroModifiers.Shift),A.metaKey&&(w|=profile_1.MacroModifiers.Meta,"darwin"==process.platform?v.push("Cmd"):v.push("Win")),library_1.keyCodeToChar[A.which])v.push(library_1.keyCodeToChar[A.which]);else return!1;return $("#MacroKey").val(v.join("+")),$("#MacroKey").data("key",A.which),$("#MacroKey").data("mod",w),UpdateMacro(),!1}),$(".btn-adv").click(function(){var A=$(this).closest(".panel-body").attr("id"),v=$(this).data("open");v=!v,$(this).data("open",v);var w=$(this).closest(".panel-body"),N=$(this).find("i"),P=w.find(".panel-adv-body");v?(P.css("display","table-row"),N.addClass("fa-chevron-down"),N.removeClass("fa-chevron-up"),$(this).parent().css("padding-bottom","15px"),$(this).closest("table").css("min-height","342px"),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:A+"Advanced",value:!0})):(P.css("display",""),N.addClass("fa-chevron-up"),N.removeClass("fa-chevron-down"),$(this).parent().css("padding-bottom",""),$(this).closest("table").css("min-height",""),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:A+"Advanced",value:!1}))}),g.profiles.triggersAdvanced&&$("#triggers .btn-adv").click(),g.profiles.aliasesAdvanced&&$("#aliases .btn-adv").click(),g.profiles.buttonsAdvanced&&$("#buttons .btn-adv").click(),g.profiles.macrosAdvanced&&$("#macros .btn-adv").click(),["cut","copy","paste"].forEach(function(A){document.addEventListener(A,function(v){console.debug(v),console.debug(document.activeElement);document.activeElement&&("INPUT"==document.activeElement.tagName||"TEXTAREA"==document.activeElement.tagName)||("cut"==A?doCut():"copy"==A?doCopy():"paste"==A&&doPaste())})}),loadActions(library_1.parseTemplate(path.join("{assets}","actions")),""),initEditor("TriggerValue"),initEditor("MacroValue"),initEditor("AliasValue"),initEditor("ButtonValue"),window.onbeforeunload=function(){if(!(close||_never||0==_undo.length&&!updateCurrent())){var A=dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"warning",title:"Profiles changed",message:"All unsaved changes will be lost, close?",buttons:["Yes","No","Never ask again"],defaultId:1});return 2===A&&(electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"askoncancel",value:!1}),A=0),0===A?void 0:""}}})}exports.init=init;function sortFiles(g,u,A){return fs.lstatSync(path.join(A,g)).isDirectory()?-1:fs.lstatSync(path.join(A,u)).isDirectory()?1:g.localeCompare(u)}function loadActions(g,u){var A=fs.readdirSync(g);A.sort(function(N,P){return sortFiles(N,P,g)});for(var v=0,w=A.length;v<w;v++)fs.lstatSync(path.join(g,A[v])).isDirectory()?loadActions(path.join(g,A[v]),path.join(u,A[v])):$("#buttonActionsDropdown").append("<li title=\""+path.basename(A[v],path.extname(A[v]))+"\"><a href=\"#\" onclick=\"profileui.setIcon('"+path.join(u,A[v]).replace(/\\/g,"\\\\")+"')\"><img class=\"action-icon\" src=\""+path.join(g,A[v])+"\"><div class=\"overlay\"></div></a></li>")}function setIcon(g){$("#ButtonIcon").val(path.join("{assets}","actions",g)),UpdateButtonSample()}exports.setIcon=setIcon;function doRefresh(){if(0<_undo.length)dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"warning",title:"Refresh profiles",message:"All unsaved or applied changes will be lost, refresh?",buttons:["Yes","No"],defaultId:1},(u)=>{if(0==u){fchanged=!1,resetUndo(),profiles=new profile_1.ProfileCollection,$("#btnRefresh").removeClass("btn-warning");var A=path.join(library_1.parseTemplate("{data}"),"profiles");fs.existsSync(A)?(profiles.load(A),!profiles.contains("default")&&profiles.add(profile_1.Profile.Default),watcher&&watcher.close(),watcher=fs.watch(A,()=>{fchanged=!0,$("#btnRefresh").addClass("btn-warning")})):profiles.add(profile_1.Profile.Default),buildTreeview(getProfileData())}});else{fchanged=!1,resetUndo(),profiles=new profile_1.ProfileCollection,$("#btnRefresh").removeClass("btn-warning");var g=path.join(library_1.parseTemplate("{data}"),"profiles");fs.existsSync(g)?(profiles.load(g),!profiles.contains("default")&&profiles.add(profile_1.Profile.Default),watcher&&watcher.close(),watcher=fs.watch(g,()=>{fchanged=!0,$("#btnRefresh").addClass("btn-warning")})):profiles.add(profile_1.Profile.Default),buildTreeview(getProfileData())}}exports.doRefresh=doRefresh;function profileCopyName(g){for(var u=0,A=g;profiles.contains(A);)A=0==u?g+" Copy":g+" Copy ("+u+")",u++;return A}function importProfiles(){dialog.showOpenDialog({filters:[{name:"Text files (*.txt)",extensions:["txt"]},{name:"All files (*.*)",extensions:["*"]}]},function(g){if(void 0!==g&&0!=g.length)for(var u=0,A=g.length;u<A;u++)fs.readFile(g[u],(v,w)=>{if(v)throw v;if(w=JSON.parse(w),!w||2!=w.version)return void dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"error",title:"Invalid Profile",message:"Invalid profile unable to process."});if(w.profiles){for(var T,B,N=[],P=Object.keys(w.profiles),M=0,C=P.length;M<C;M++){T=profileCopyName(P[M]),N.push(T);var S=new profile_1.Profile(T);S.priority=w.profiles[P[M]].priority,S.enabled=w.profiles[P[M]].enabled,S.enableMacros=w.profiles[P[M]].enableMacros,S.enableTriggers=w.profiles[P[M]].enableTriggers,S.enableAliases=w.profiles[P[M]].enableAliases,S.macros=[];var L=w.profiles[P[M]].macros.length;if(0<L)for(var V=0;V<L;V++)B=new profile_1.Macro,B.key=w.profiles[P[M]].macros[V].key,B.value=w.profiles[P[M]].macros[V].value,B.style=w.profiles[P[M]].macros[V].style,B.append=w.profiles[P[M]].macros[V].append,B.send=w.profiles[P[M]].macros[V].send,B.name=w.profiles[P[M]].macros[V].name,B.group=w.profiles[P[M]].macros[V].group,B.enabled=w.profiles[P[M]].macros[V].enabled,B.modifiers=w.profiles[P[M]].macros[V].modifiers,B.chain=w.profiles[P[M]].macros[V].chain,B.notes=w.profiles[P[M]].macros[V].notes||"",S.macros.push(B);if(L=w.profiles[P[M]].aliases.length,0<L)for(var V=0;V<L;V++)B=new profile_1.Alias,B.pattern=w.profiles[P[M]].aliases[V].pattern,B.value=w.profiles[P[M]].aliases[V].value,B.style=w.profiles[P[M]].aliases[V].style,B.multi=w.profiles[P[M]].aliases[V].multi,B.append=w.profiles[P[M]].aliases[V].append,B.name=w.profiles[P[M]].aliases[V].name,B.group=w.profiles[P[M]].aliases[V].group,B.enabled=w.profiles[P[M]].aliases[V].enabled,B.params=w.profiles[P[M]].aliases[V].params,B.regexp=w.profiles[P[M]].aliases[V].regexp,B.priority=w.profiles[P[M]].aliases[V].priority,B.notes=w.profiles[P[M]].aliases[V].notes||"",S.aliases.push(B);if(L=w.profiles[P[M]].triggers.length,0<L)for(var V=0;V<L;V++)B=new profile_1.Trigger,B.pattern=w.profiles[P[M]].triggers[V].pattern,B.value=w.profiles[P[M]].triggers[V].value,B.style=w.profiles[P[M]].triggers[V].style,B.verbatim=w.profiles[P[M]].triggers[V].verbatim,B.name=w.profiles[P[M]].triggers[V].name,B.group=w.profiles[P[M]].triggers[V].group,B.enabled=w.profiles[P[M]].triggers[V].enabled,B.priority=w.profiles[P[M]].triggers[V].priority,B.triggerNewline=w.profiles[P[M]].triggers[V].triggernewline,B.triggerPrompt=w.profiles[P[M]].triggers[V].triggerprompt,B.type=w.profiles[P[M]].triggers[V].type,B.notes=w.profiles[P[M]].triggers[V].notes||"",S.triggers.push(B);if(w.profiles[P[M]].buttons&&(L=w.profiles[P[M]].buttons.length,0<L))for(var V=0;V<L;V++)B=new profile_1.Button,B.name=w.profiles[P[M]].buttons[V].name,B.priority=w.profiles[P[M]].buttons[V].priority,B.value=w.profiles[P[M]].buttons[V].value,B.style=w.profiles[P[M]].buttons[V].style,B.group=w.profiles[P[M]].buttons[V].group,B.enabled=w.profiles[P[M]].buttons[V].enabled,B.notes=w.profiles[P[M]].buttons[V].notes||"",B.caption=w.profiles[P[M]].buttons[V].caption,B.icon=w.profiles[P[M]].buttons[V].icon,B.append=w.profiles[P[M]].buttons[V].append,B.send=w.profiles[P[M]].buttons[V].send,B.chain=w.profiles[P[M]].buttons[V].send,B.stretch=w.profiles[P[M]].buttons[V].send,S.buttons.push(B);profiles.add(S);var D=T;T=T.toLowerCase();var I={text:D,id:"Profile"+profileID(T),state:{checked:profiles.items[T].enabled},dataAttr:{type:"profile",profile:T},nodes:[{text:"Aliases",id:"Profile"+profileID(T)+"aliases",dataAttr:{profile:T},lazyLoad:0<profiles.items[T].aliases.length,state:{checked:profiles.items[T].enableAliases}},{text:"Macros",id:"Profile"+profileID(T)+"macros",dataAttr:{profile:T},lazyLoad:0<profiles.items[T].macros.length,state:{checked:profiles.items[T].enableMacros}},{text:"Triggers",id:"Profile"+profileID(T)+"triggers",dataAttr:{profile:T},lazyLoad:0<profiles.items[T].triggers.length,state:{checked:profiles.items[T].enableTriggers}},{text:"Buttons",id:"Profile"+profileID(T)+"buttons",dataAttr:{profile:T},lazyLoad:0<profiles.items[T].buttons.length,state:{checked:profiles.items[T].enableButtons}}]};$("#tree").treeview("addNode",[I,!1,!1])}pushUndo({action:"add",type:"profile",item:N})}})})}function trashProfiles(g){if(0<_remove.length)for(var u=0,A=_remove.length;u<A;u++)electron_1.shell.moveItemToTrash(path.join(g,_remove[u]+".json"))}exports.trashProfiles=trashProfiles;function saveProfiles(){if(!updateCurrent())return!1;if(fchanged)dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"question",title:"Profiles updated",message:"Profiles have been updated outside of manager, save anyways?",buttons:["Yes","No"],defaultId:1},(u)=>{if(0==u){var A=path.join(library_1.parseTemplate("{data}"),"profiles");fs.existsSync(A)||fs.mkdirSync(A),profiles.save(A),trashProfiles(A),electron_1.ipcRenderer.send("reload-profiles"),setTimeout(clearChanges,500)}});else{var g=path.join(library_1.parseTemplate("{data}"),"profiles");fs.existsSync(g)||fs.mkdirSync(g),profiles.save(g),trashProfiles(g),electron_1.ipcRenderer.send("reload-profiles"),setTimeout(clearChanges,500)}return!0}exports.saveProfiles=saveProfiles;function clearChanges(){resetUndo(),fchanged=!1,$("#btnRefresh").removeClass("btn-warning")}var editors={},aceTooltip;function initEditor(g){var u=$("#"+g).hide();$("#"+g+"Editor").css("display","block"),ace.require("ace/ext/language_tools"),editors[g]=ace.edit(g+"Editor");var A=editors[g].getSession();if(editors[g].$blockScrolling=Infinity,editors[g].getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},!aceTooltip){var v=ace.require("ace/tooltip").Tooltip;aceTooltip=new v($("#editor")[0])}editors[g].setTheme("ace/theme/visual_studio"),A.setMode("ace/mode/text"),A.setUseSoftTabs(!0),A.setValue(u.val()),editors[g].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,newLineMode:"unix",tabSize:3}),editors[g].commands.addCommand({name:"expand all folds",bindKey:{win:"Ctrl-Shift-+",mac:"Command-Option-+"},exec:function(w){w.getSession().unfold()}}),editors[g].commands.addCommand({name:"collapse all folds",bindKey:{win:"Ctrl-Shift--",mac:"Command-Option--"},exec:function(w){w.getSession().foldAll()}}),A.on("changeFold",function(){aceTooltip.hide()}),editors[g].on("mousemove",function(w){var N=w.getDocumentPosition(),P=w.editor.getSession().getFoldAt(N.row,N.column,1);if(P){var T=w.editor.getSession().getDocument().getTextRange(P.range).replace(/^\n+|\s+$/g,""),M=T.split(/\n/);10<M.length&&(T=M.slice(0,10).join("\n").replace(/\s+$/g,"")+"\n...");var C=$(window).height(),B=aceTooltip.getHeight(),S=w.clientX+32,L=w.clientY;L+B>C&&(L-=B),aceTooltip.show(T,S,L),w.stop()}else aceTooltip.hide()})}var i=0,dragging=!1;function resetUndo(){_undo=[],_redo=[],updateUndoState()}function pushUndo(g){_pUndo||(_undo.push(g),_redo=[],updateUndoState(),console.log(_undo))}function updateUndoState(){$("#btnUndo").prop("disabled",0==_undo.length),$("#btnRedo").prop("disabled",0==_redo.length),console.log(_undo),console.log(_redo)}exports.updateUndoState=updateUndoState;function DeleteProfileConfirm(g){dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"question",title:"Delete profile?",message:"Delete "+g.name+"?",buttons:["Yes","No"],defaultId:1},(u)=>{0==u&&DeleteProfile(g)})}function DeleteProfile(g){g||(g=currentProfile),_remove.push(g.name),pushUndo({action:"delete",type:"profile",item:g});var u=$("#tree").treeview("findNodes",["^Profile"+profileID(g.name)+"$","id"]);g.name==currentProfile.name&&$("#tree").treeview("selectNode",[$("#tree").treeview("findNodes",["^Profiledefault$","id"])]),$("#tree").treeview("removeNode",[u,{silent:!0}]),profiles.remove(g)}function DeleteItems(g,u,A){dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"question",title:"Delete "+g+"?",message:"Are you sure you want to delete all "+u+"?",buttons:["Yes","No"],defaultId:1},(v)=>{if(0==v){var w={action:"group",add:[],delete:[]},N=$("#tree").treeview("findNodes",["Profile"+profileID(A.name)+u,"id"]);$("#tree").treeview("expandNode",[N,{levels:1,silent:!0}]);for(var P=A[u].length-1;0<=P;P--)w.delete.unshift({type:g,data:{key:u,idx:P,profile:A.name.toLowerCase()},item:A[u][P]}),DeleteItem(g,u,P,A,!0);pushUndo(w)}})}function DeleteItemConfirm(g,u,A,v){dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"question",title:"Delete "+g+"?",message:"Are you sure you want to delete this "+g+"?",buttons:["Yes","No"],defaultId:1},(w)=>{0==w&&DeleteItem(g.toLowerCase(),u,A,v)})}function DeleteItem(g,u,A,v,w){var N,P,T,M,C,B,S;v||(v=currentProfile),w||pushUndo({action:"delete",type:g,data:{key:u,idx:A,profile:v.name.toLowerCase()},item:v[u][A]}),S=profileID(v.name),T=$("#tree").treeview("findNodes",["Profile"+S+u+A,"id"]),T&&0<T.length&&T[0].state.selected&&(currentNode=null),$("#tree").treeview("removeNode",[T,{silent:!0}]),v[u].splice(A,1);var C;if(0<(N=v[u].length)){for(P=A;P<N;P++)T=$("#tree").treeview("findNodes",["Profile"+S+u+(P+1),"id"]),T=T&&0<T.length?T[0]:null,B=v[u][P],M={text:GetDisplay(B),id:"Profile"+S+u+P,dataAttr:{type:g.toLowerCase(),profile:v.name.toLowerCase(),index:P},state:{checked:B.enabled,selected:T&&T.state&&T.state.selected}},T&&(T.state&&T.state.selected&&(C=M.id),$("#tree").treeview("updateNode",[T,M]));if(C){var T=$("#tree").treeview("findNodes",["^"+C+"$","id"])[0];currentNode=T,$("#tree").treeview("selectNode",[T])}}}function doClose(){_never||0==_undo.length&&!updateCurrent()?(_close=!0,window.close()):dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"warning",title:"Profiles changed",message:"All unsaved changes will be lost, close?",buttons:["Yes","No","Never ask again"],defaultId:1},(g)=>{0==g?window.close():2==g&&(_never=!1,_close=!0,window.close(),electron_1.ipcRenderer.send("setting-changed",{type:"profiles",name:"askoncancel",value:!1}))})}exports.doClose=doClose;function doImport(g){if(g||(g=currentNode,!!g)){for(var u=profiles.items[g.dataAttr.profile],A=profile_1.Profile.DefaultMacros,v={action:"group",add:[],delete:[]},w=0,N=A.length;w<N;w++)v.add.push({type:"macro",item:A[w].clone(),data:{type:"macro",key:"macros",item:A[w].clone(),id:u.macros.length,profile:u.name.toLowerCase()}}),addItem("macro","macros",A[w],u.macros.length,u,!0);pushUndo(v)}}exports.doImport=doImport;function doReset(g){if(g||(g=currentNode,!!g)){var u=profiles.items[g.dataAttr.profile];dialog.showMessageBox(electron_1.remote.getCurrentWindow(),{type:"warning",title:"Reset "+u.name,message:"Resetting will loose all profile data, reset?",buttons:["Yes","No"],defaultId:1},(A)=>{if(0==A){pushUndo({action:"reset",type:"profile",profile:u.clone()});var v=$("#tree").treeview("findNodes",["Profile"+profileID(u.name)+"macros[0-9]+","id"]);v=v.concat($("#tree").treeview("findNodes",["Profile"+profileID(u.name)+"triggers[0-9]+","id"])),v=v.concat($("#tree").treeview("findNodes",["Profile"+profileID(u.name)+"buttons[0-9]+","id"])),v=v.concat($("#tree").treeview("findNodes",["Profile"+profileID(u.name)+"aliases[0-9]+","id"])),$("#tree").treeview("removeNode",[v,{silent:!0}]),v={text:"Aliases",id:"Profile"+profileID(u.name)+"aliases",dataAttr:{profile:u.name.toLowerCase(),type:"aliases"},lazyLoad:0,state:{checked:u.enableAliases}},w=$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"aliases$","id"]),$("#tree").treeview("updateNode",[w[0],v]),v={text:"Macros",id:"Profile"+profileID(u.name)+"macros",dataAttr:{profile:u.name.toLowerCase(),type:"macros"},lazyLoad:0,state:{checked:u.enableMacros}};var w=$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"macros$","id"]);$("#tree").treeview("updateNode",[w[0],v]),v={text:"Triggers",id:"Profile"+profileID(u.name)+"triggers",dataAttr:{profile:u.name.toLowerCase(),type:"triggers"},lazyLoad:0,state:{checked:u.enableTriggers}};var w=$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"triggers$","id"]);$("#tree").treeview("updateNode",[w[0],v]),v={text:"Buttons",id:"Profile"+profileID(u.name)+"buttons",dataAttr:{profile:u.name.toLowerCase(),type:"buttons"},lazyLoad:0,state:{checked:u.enableButtons}};var w=$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"buttons$","id"]);$("#tree").treeview("updateNode",[w[0],v]),u.aliases=[],u.macros=[],u.triggers=[],u.buttons=[],u.enableMacros=!0,u.enableTriggers=!0,u.enableAliases=!0,u.enableButtons=!0,u.priority=0,u.enabled=!0,u.name==currentProfile.name&&($("#enableAliases").prop("checked",currentProfile.enableAliases),$("#enableMacros").prop("checked",currentProfile.enableMacros),$("#enableTriggers").prop("checked",currentProfile.enableTriggers),$("#enableButtons").prop("checked",currentProfile.enableButtons),$("#enabled").prop("checked",currentProfile.enabled),$("#profilePriority").val(currentProfile.priority)),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"macros$","id"])]),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"aliases$","id"])]),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"triggers$","id"])]),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"buttons$","id"])]),$("#tree").treeview("checkNode",[$("#tree").treeview("findNodes",["^Profile"+profileID(u.name)+"$","id"])])}})}}exports.doReset=doReset;