<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>jiMUD</title>
    <link href="../lib/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        body {
            text-align: center;
            padding: 0px;
            margin: 0px;
        }

        #logo-version {
            position: absolute;
            right: 30px;
            top: 120px;
            z-index: 1;
            color: white;
            font-weight: bold;
        }

        .box {
            border-radius: 4px;
            text-align: left;
            border: 1px #333 solid;
            padding: 4px;
            position: absolute;
        }

        .info {
            bottom: 10px;
            left: 10px;
            right: 10px;
            top: 176px;
        }

        .info-version {
            left: 10px;
            right: 10px;
            top: 145px;
        }

        #memory th {
            font-size: 0.7em;
        }

        #memory td {
            text-align: right;
            white-space: nowrap;
        }

        #memory td:first-child {
            text-align: left;
        }

        .totals {
            font-weight: bold;
        }

        #logo {
            background: black;
            border: silver;
            color: white;
            height: 148px;
            overflow: hidden;
            position: relative;
        }

        #logo-text {
            text-align: center;
            font-size: 90px;
            font-family: 'Courier New', Courier, monospace;
            float: left;
            display: inline;
        }

        #logo-image {
            float: left;
            padding: 10px;
        }

        #logo-editor {
            display: none;
            font-size: 32px;
            font-family: 'Courier New', Courier, monospace;
            position: absolute;
            bottom: 0;
            z-index: 100;
            left: 148px;
            margin: 0px;
            padding: 0px;
            text-align: left;
            right: 0;
        }
    </style>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/bootstrap.min.js"></script>
    <script>
        if (window.module) module.module;
    </script>
    <script>
        const { version } = require('../package.json');
        const { remote } = require('electron');

        //function formatBytes(a,b){if(0==a)return"0 Bytes";var c=1e3,d=b||2,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return parseFloat((a/Math.pow(c,f)).toFixed(d))+" "+e[f];}
        $(document).ready(() => {
            $('#ev').text(process.versions.electron);
            $('#nv').text(process.versions.node);
            $('#cv').text(process.versions.chrome);
            $('#logo-version').text('v' + version);

            var mi = remote.app.getAppMetrics();
            var total = [0, 0, 0, 0, 0, 0];
            for (var i = 0; i < mi.length; i++) {
                var row = '<tr><td>' + mi[i].pid + '</td>';
                row += '<td>' + mi[i].type + '</td>';
                row += '<td>' + (mi[i].memory.peakWorkingSetSize).toLocaleString() + ' K</td>';
                row += '<td>' + (mi[i].memory.privateBytes).toLocaleString() + 'K</td>';
                row += '<td>' + (mi[i].memory.sharedBytes).toLocaleString() + ' K</td>';
                row += '<td>' + (mi[i].memory.workingSetSize).toLocaleString() + ' K</td>';
                row += '<td>' + (mi[i].cpu.percentCPUUsage || 0.0).toFixed(3) + '%</td>';
                row += '<td>' + mi[i].cpu.idleWakeupsPerSecond + '</td></tr>';
                $('#memory tbody').append(row);
                total[0] += mi[i].memory.peakWorkingSetSize;
                total[1] += mi[i].memory.privateBytes;
                total[2] += mi[i].memory.sharedBytes;
                total[3] += mi[i].memory.workingSetSize;
                total[4] += (mi[i].cpu.percentCPUUsage || 0.0);
                total[5] += mi[i].cpu.idleWakeupsPerSecond;
            }
            row = '<tr class=\'totals\'><td>Total:</td>';
            row += '<td></td>';
            row += '<td>' + (total[0]).toLocaleString() + ' K</td>';
            row += '<td>' + (total[1]).toLocaleString() + ' K</td>';
            row += '<td>' + (total[2]).toLocaleString() + ' K</td>';
            row += '<td>' + (total[3]).toLocaleString() + ' K</td>';
            row += '<td>' + total[4].toFixed(3) + '%</td>';
            row += '<td>' + total[5] + '</td></tr>';
            $('#memory tbody').append(row);
            /*
            var mi = remote.process.getProcessMemoryInfo();
            var ci = remote.process.getCPUUsage();

            var row = '<tr><td>' + remote.process.pid + '</td>';
            row += '<td>' + remote.process.type + '</td>';
            row += '<td>' + (mi.peakWorkingSetSize).toLocaleString() + ' K</td>';
            row += '<td>' + (mi.privateBytes).toLocaleString() + 'K</td>';
            row += '<td>' + (mi.sharedBytes).toLocaleString() + ' K</td>';
            row += '<td>' + (mi.workingSetSize).toLocaleString() + ' K</td>';
            row += '<td>' + (ci.percentCPUUsage || 0.0).toFixed(3) + '%</td>';
            row += '<td>' + ci.idleWakeupsPerSecond + '</td></tr>';
            $('#memory tbody').append(row);
            */
            if (remote.getGlobal('editorOnly'))
                $('#logo-editor').css('display', 'block');

        });

        $(window).keydown((event) => {
            if (event.which === 27)
                window.close();
        });
    </script>
</head>

<body>
    <div id="logo">
        <img id="logo-image" src="./../assets/icons/png/128x128.png" />
        <div id="logo-text">jiMUD</div>
        <span id="logo-editor">Code editor</span>
        <div id="logo-version"></div>
    </div>
    <div style="margin:2px;text-align:left;">

        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#general" aria-controls="general" role="tab" data-toggle="tab">General</a></li>
            <li role="presentation"><a href="#memory" aria-controls="memory" role="tab" data-toggle="tab">Memory</a></li>
        </ul>

        <div class="tab-content">
            <div role="tabpanel" class="container tab-pane fade in active" id="general">
                Electron: <span id="ev"></span> - https://electronjs.org/<br /> Node: <span id="nv"></span> - http://www.nodejs.org/<br /> Chromium: <span id="cv"></span> - https://www.chromium.org/Home<br /> Buzz: 1.2.0 - http://buzz.jaysalvat.com<br /> jQuery: 3.1.1 - http://www.jquery.com<br /> Icons: http://opengameart.org/<br /> Font Awesome: v4.7.0 - http://http://fontawesome.io/
                <br /><br />&copy; 2017-2018
            </div>
            <div role="tabpanel" class="tab-pane fade" id="memory" style="height: 185px;overflow: auto;text-align: right">
                <table id="memory" style="width: 100%;" class="table table-striped table-hover table-condensed">
                    <thead>
                        <tr style="text-align: center">
                            <th>PID</th>
                            <th>Type</th>
                            <th>Peak Working Set</th>
                            <th>Private</th>
                            <th>Shared</th>
                            <th>Working Set</th>
                            <th>CPU Usage</th>
                            <th>idle Wakeups/Second</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</div>