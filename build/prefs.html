<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>Preferences</title>
    <link rel="shortcut icon" href="../assets/icons/png/preferences.png" />
    <link href="../lib/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/bootstrap-treeview.min.css" rel="stylesheet" type="text/css" />
    <link href="../lib/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="css/form.css" rel="stylesheet" type="text/css" />
    <style>
        body {
      -webkit-user-select: none;
      user-select: none;
      overflow: hidden;
    }


    #pref-tree {
      padding: 0px;
      margin: 0;
      position: absolute;
      left: 0;
      top: 0;
      bottom: 57px;
      width: 200px;
      overflow: auto;
    }

    #pref-tree .list-group {
      margin: 0;
      box-shadow: none;
    }

    #content {
      position: absolute;
      right: 0px;
      top: 0;
      bottom: 57px;
      left: 202px;
      margin: 0;
    }

    #pref-editor {
      overflow: auto;
      position: absolute;
      right: 0;
      top: 42px;
      bottom: 0;
      left: 0;
      margin: 0;
    }

    .node-pref-tree {
      padding: 2px;
      border-top-right-radius: 0px !important;
      border-top-left-radius: 0px !important;
      border-bottom-right-radius: 0px !important;
      border-bottom-left-radius: 0px !important;
    }

    .pref-pane {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      left: 0;
      margin: 0;
      display: none;
      padding-top: 15px;
      padding-bottom: 15px;
    }

    hr {
      height: 1px;
      background-color: #eee;
      margin-top: 20px;
      margin-bottom: 20px;
      width: 75%;
    }

    .bootstrap-select .dropdown-menu {
        max-height: 200px !important;
    }
  </style>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/bootstrap.min.js"></script>
    <script src="../lib/bootstrap-select.min.js"></script>
    <script src="../lib/bootstrap-treeview.min.js"></script>
    <script type="text/javascript">
        //spell-checker:ignore rgbcolor cmdfont selectpicker commandon prepend tablist tabpanel hellip emoteto  ABCDEFGHIJKLMNOPQRSTUVWXYZ
        const { parseTemplate, templatePath, existsSync, getColors, isFileSync, isDirSync, walkSync } = require('./js/library');
        const { TrayClick } = require('./js/types');
        const Settings = require('./js/settings').Settings;
        const { remote, ipcRenderer } = require('electron');
        const { dialog } = remote;
        const RGBColor = require('rgbcolor');
        const path = require('path');
        const fs = require('fs');
        var fontManager;
        var currentColors;

        var archiver, archive;

        try {
            fontManager = require('font-manager');
        }
        catch (ex) {
            ipcRenderer.send('error', ex);
        }

        var _settings;
        if (window.module) module.module;
        $(window).keydown((event) => {
            if (document.getElementById('progress-dialog').open) {
                event.preventDefault();
                return false;
            }            
            if (event.which === 27)
                window.close();
        });

        $(document).ready(() => {

            $('#pref-tree').treeview({
                showBorder: false,
                showImage: true,
                showTags: true,
                showCheckbox: false,
                preventUnselect: true,
                levels: 1,
                checkedIcon: 'fa fa-check-square-o',
                uncheckedIcon: 'fa fa-square-o',
                expandIcon: 'fa fa-chevron-right',
                collapseIcon: 'fa fa-chevron-down',
                onNodeRendered: (event, node) => {
                    node.$el.prop('title', node.text);
                },
                onNodeSelected: (event, node) => {
                    $('.pref-pane').css('display', '');
                    if (node.dataAttr && node.dataAttr.pane)
                        $('#' + node.dataAttr.pane).css('display', 'block');
                    else
                        $('#' + node.text.toLowerCase().replace(/\s/g, '-')).css('display', 'block');
                    if (node.dataAttr && node.dataAttr.title)
                        $('#pref-title').html(node.dataAttr.title.replace(/>/g, '<i class="fa fa-angle-double-right" aria-hidden="true"></i>'));
                    else
                        $('#pref-title').html(node.text);
                },
                data: [
                    { text: 'General' },
                    {
                        text: 'Display',
                        nodes: [
                            { text: 'Fonts', dataAttr: { title: 'Display > Fonts', pane: 'display-fonts' } },
                        ]
                    },
                    { text: 'Command line' },
                    { text: 'Colors' },
                    {
                        text: 'Logging',
                        nodes: [
                            { text: 'Viewer', dataAttr: { title: 'Logging > Viewer', pane: 'logging-viewer' } },
                        ]
                    },
                    { text: 'Telnet' },
                    {
                        text: 'Mapper',
                        nodes: [
                            { text: 'Window', dataAttr: { title: 'Mapper > Window', pane: 'mapper-window' } },
                        ]
                    },
                    {
                        text: 'Chat',
                        nodes: [
                            { text: 'Display', dataAttr: { title: 'Chat > Display', pane: 'chat-display' } },
                            { text: 'Window', dataAttr: { title: 'Chat > Window', pane: 'chat-window' } },
                        ]
                    },
                    { text: 'Status' },
                    {
                        text: 'Scripting',
                        nodes: [
                            { text: 'Special characters', dataAttr: { title: 'Scripting > Special characters' } },
                        ]
                    },
                    {
                        text: 'Advanced',
                        nodes: [
                            { text: 'Tray' }
                        ]
                    },
                ],
                onInitialized: () => {
                    $('#pref-tree').treeview('expandAll', { levels: 5, silent: true });
                    const n = $('#pref-tree').treeview('findNodes', ['^General$', 'text']);
                    $('#pref-tree').treeview('selectNode', [n]);
                }
            });

            if (process.platform === 'win32')
                $('.win32').css('display', 'inline-block');
            else
                $('.win32').css('display', 'none');
            if (fontManager) {
                fontManager.getAvailableFonts((fonts) => {
                    var fl = fonts.length;
                    var f = 0;
                    var sFont = {};
                    var ops = [];
                    fonts.sort((a, b) => a.family.localeCompare(b.family));
                    for (f = 0; f < fl; f++) {
                        if (sFont[fonts[f].family]) continue;
                        if (fonts[f].monospace)
                            ops.push(`<option style="font-family: '${fonts[f].family}', monospace" value="'${fonts[f].family}', monospace">'${fonts[f].family}', monospace</option>`);
                        else
                            ops.push(`<option style="font-family: '${fonts[f].family}'" value="'${fonts[f].family}'">'${fonts[f].family}'</option>`);
                        sFont[fonts[f].family] = true;
                    }
                    ops = ops.join('');
                    $('#font-system').append(ops);
                    $('#cmdfont-system').append(ops);
                    $('#chat-font-system').append(ops);

                    $('#font').selectpicker('refresh');
                    $('#cmdfont').selectpicker('refresh');
                    $('#chat-font').selectpicker('refresh');
                    $('#font').val(_settings.font);
                    $('#font').selectpicker('render');
                    $('#font').change();
                    $('#cmdfont').val(_settings.cmdfont);
                    $('#cmdfont').selectpicker('render');
                    $('#cmdfont').change();

                    $('#chat-font').val(_settings.chat.font);
                    $('#chat-font').selectpicker('render');
                    $('#chat-font').change();
                });
            }
            $('#font').change(() => {
                $('#font-sample').css('font-family', $('#font').val() + ', monospace');
                $('#font-sample').css('font-size', $('#fontSize').val());
            });

            $('#fontSize').change(() => {
                $('#font-sample').css('font-family', $('#font').val() + ', monospace');
                $('#font-sample').css('font-size', $('#fontSize').val());
            });

            $('#cmdfont').change(() => {
                $('#cmd-font-sample').css('font-family', $('#cmdfont').val() + ', monospace');
                $('#cmd-font-sample').css('font-size', $('#cmdfontSize').val());
            });

            $('#cmdfontSize').change(() => {
                $('#cmd-font-sample').css('font-family', $('#cmdfont').val() + ', monospace');
                $('#cmd-font-sample').css('font-size', $('#cmdfontSize').val());
            });

            $('#chat-font').change(() => {
                $('#chat-font-sample').css('font-family', $('#chat-font').val() + ', monospace');
                $('#chat-font-sample').css('font-size', $('#chat-fontSize').val());
            });

            $('#chat-fontSize').change(() => {
                $('#chat-font-sample').css('font-family', $('#chat-font').val() + ', monospace');
                $('#chat-font-sample').css('font-size', $('#chat-fontSize').val());
            });

            _settings = Settings.load(remote.getGlobal('settingsFile'));
            loadThemes();
            loadSettings();

            $('input[type="checkbox"]').change(function () {
                var id;
                switch ($(this).attr('id')) {
                    case 'logging-viewer-reopen':
                        if (!_settings.extensions['log-viewer'])
                            _settings.extensions['log-viewer'] = {
                                'opened': [],
                                'browse': null,
                                'recent': [],
                                'reopen': true
                            };
                        _settings.extensions['log-viewer'].reopen = this.checked;
                        break;
                    case 'logging-viewer-alwaysOnTopClient':
                    case 'logging-viewer-alwaysOnTop':
                    case 'logging-viewer-persistent':
                        if (!_settings.windows['log-viewer'] || !_settings.windows['log-viewer'].options)
                            _settings.windows['log-viewer'].options = {
                                persistent: false,
                                alwaysOnTopClient: true,
                                alwaysOnTop: false
                            };
                        id = $(this).attr('id').split('-');
                        _settings.windows['log-viewer'].options[id[2]] = this.checked;
                        break;
                    case 'chat-alwaysOnTop':
                        _settings.chat.alwaysOnTop = this.checked;
                        break;
                    case 'chat-alwaysOnTopClient':
                        _settings.chat.alwaysOnTopClient = this.checked;
                        break;
                    case 'chat-captureLines':
                        _settings.chat.captureLines = this.checked;
                        $('#chat-lines').prop('readonly', !_settings.chat.captureLines || _settings.chat.captureAllLines);

                        $('#chat-selective').prop('disabled', !_settings.chat.captureLines);
                        $('#chat-captureAllLines').prop('disabled', !_settings.chat.captureLines);
                        break;
                    case 'chat-captureReviews':
                        _settings.chat.captureReviews = this.checked;
                        break;
                    case 'chat-captureTells':
                        _settings.chat.captureTells = this.checked;
                        break;
                    case 'chat-captureTalk':
                        _settings.chat.captureTalk = this.checked;
                        break;
                    case 'chat-persistent':
                        _settings.chat.persistent = this.checked;
                        break;
                    case 'mapper-persistent':
                        _settings.mapper.persistent = this.checked;
                        break;
                    case 'mapper-alwaysOnTop':
                        _settings.mapper.alwaysOnTop = this.checked;
                        break;
                    case 'mapper-alwaysOnTopClient':
                        _settings.mapper.alwaysOnTopClient = this.checked;
                        break;
                    case 'mapper-importTypeReplace':
                        _settings.mapper.importType = 1;
                        break;
                    case 'mapper-importTypMerge':
                        _settings.mapper.importType = 0;
                        break;
                    case 'MapperSplitArea':
                        _settings.mapper.split = this.checked;
                        break;
                    case 'mapFollow':
                        _settings.mapper.follow = this.checked;
                        break;
                    case 'mapEnabled':
                        _settings.mapper.enabled = this.checked;
                        break;
                    case 'MapperFillWalls':
                        _settings.mapper.fill = this.checked;
                        break;
                    case 'mapLegend':
                        _settings.mapper.legend = this.checked;
                        break;
                    case 'mapper-memory':
                        _settings.mapper.memory = this.checked;
                        if (this.checked) {
                            dialog.showMessageBox(remote.getCurrentWindow(), {
                                type: 'warning',
                                title: 'Warning',
                                message: 'If client or OS crash, all in memory data will be lost and not saved to disk'
                            });
                        }
                        break;
                    case 'logWhat-html':
                    case 'logWhat-text':
                    case 'logWhat-raw':
                        _settings.logWhat = 0;
                        if ($('#logWhat-html').prop('checked'))
                            _settings.logWhat |= 1;
                        if ($('#logWhat-text').prop('checked'))
                            _settings.logWhat |= 2;
                        if ($('#logWhat-raw').prop('checked'))
                            _settings.logWhat |= 4;
                        break;
                    case 'backup-save-settings':
                    case 'backup-save-profiles':
                    case 'backup-save-map':
                        _settings.backupSave = 0;
                        if ($('#backup-save-map').prop('checked'))
                            _settings.backupSave |= 2;
                        if ($('#backup-save-profiles').prop('checked'))
                            _settings.backupSave |= 4;
                        if ($('#backup-save-settings').prop('checked'))
                            _settings.backupSave |= 8;
                        break;
                    case 'backup-load-settings':
                    case 'backup-load-profiles':
                    case 'backup-load-map':
                        _settings.backupLoad = 0;
                        if ($('#backup-load-map').prop('checked'))
                            _settings.backupLoad |= 2;
                        if ($('#backup-load-profiles').prop('checked'))
                            _settings.backupLoad |= 4;
                        if ($('#backup-load-settings').prop('checked'))
                            _settings.backupLoad |= 8;
                        break;
                    default:
                        id = $(this).attr('id').split('-');
                        if (id.length === 2)
                            _settings[id[0]][id[1]] = this.checked;
                        else
                            _settings[id[0]] = this.checked;
                        break;
                }
            });

            $('input[type="radio"]').change(function () {
                switch ($(this).attr('id')) {
                    case 'newlineShortcut-0':
                        if (this.checked)
                            _settings.newlineShortcut = 0;
                        break;
                    case 'newlineShortcut-1':
                        if (this.checked)
                            _settings.newlineShortcut = 1;
                        break;
                    case 'newlineShortcut-2':
                        if (this.checked)
                            _settings.newlineShortcut = 2;
                        break;
                    case 'newlineShortcut-4':
                        if (this.checked)
                            _settings.newlineShortcut = 4;
                        break;
                    case 'newlineShortcut-8':
                        if (this.checked)
                            _settings.newlineShortcut = 8;
                        break;
                    case 'onDisconnect-0':
                        if (this.checked)
                            _settings.onDisconnect = 0;
                        break;
                    case 'onDisconnect-1':
                        if (this.checked)
                            _settings.onDisconnect = 1;
                        break;
                    case 'onDisconnect-2':
                        if (this.checked)
                            _settings.onDisconnect = 2;
                        break;
                    case 'onDisconnect-4':
                        if (this.checked)
                            _settings.onDisconnect = 4;
                        break;
                    case 'onDisconnect-8':
                        if (this.checked)
                            _settings.onDisconnect = 8;
                        break;

                    case 'trayClick-none':
                        if (this.checked)
                            _settings.trayClick = TrayClick.none;
                        break;
                    case 'trayClick-show':
                        if (this.checked)
                            _settings.trayClick = TrayClick.show;
                        break;
                    case 'trayClick-hide':
                        if (this.checked)
                            _settings.trayClick = TrayClick.hide;
                        break;
                    case 'trayClick-toggle':
                        if (this.checked)
                            _settings.trayClick = TrayClick.toggle;
                        break;
                    case 'trayClick-menu':
                        if (this.checked)
                            _settings.trayClick = TrayClick.menu;
                        break;
                    case 'trayDblClick-none':
                        if (this.checked)
                            _settings.trayDblClick = TrayClick.none;
                        break;
                    case 'trayDblClick-show':
                        if (this.checked)
                            _settings.trayDblClick = TrayClick.show;
                        break;
                    case 'trayDblClick-hide':
                        if (this.checked)
                            _settings.trayDblClick = TrayClick.hide;
                        break;
                    case 'trayDblClick-toggle':
                        if (this.checked)
                            _settings.trayDblClick = TrayClick.toggle;
                        break;
                    case 'trayDblClick-menu':
                        if (this.checked)
                            _settings.trayDblClick = TrayClick.menu;
                        break;
                    case 'chat-selective':
                        _settings.chat.captureAllLines = !this.checked;
                        $('#chat-lines').prop('readonly', !_settings.chat.captureLines || !this.checked);
                        break;
                    case 'chat-captureAllLines':
                        _settings.chat.captureAllLines = this.checked;
                        $('#chat-lines').prop('readonly', !_settings.chat.captureLines || this.checked);
                        break;
                }
            });

            $('input[type="text"]').change(function () {
                _settings[$(this).attr('id')] = $(this).val();
            });
            $('input[type="number"]').change(function () {
                if ($(this).attr('id') === 'mapper-memorySavePeriod')
                    _settings.mapper.memorySavePeriod = parseInt($(this).val(), 10);
                else
                    _settings[$(this).attr('id')] = parseInt($(this).val(), 10);
            });
            $('input[type="color"]').change(function () {
                var idx = parseInt($(this).attr('id').match(/\d+/)[0], 10);
                var color = new RGBColor($(this).val());
                if (color.ok)
                    _settings.colors[idx] = color.toRGB();
            });

            $('.selectpicker').change(function () {
                switch ($(this).attr('id')) {
                    case 'colorScheme':
                        break;
                    case 'chat-font':
                        _settings.chat.font = $(this).val();
                        break;
                    case 'chat-fontSize':
                        _settings.chat.fontSize = $(this).val();
                        break;
                    default:
                        _settings[$(this).attr('id')] = $(this).val();
                        break;
                }
            });
            $('#colorScheme').parent().find('.dropdown-menu.inner li').click(function () {
                //$("#colorScheme").change();
                updateScheme($(this).index());
            });
            $('#btn-logPath').on('click', () => {
                dialog.showOpenDialog(remote.getCurrentWindow(), {
                    defaultPath: parseTemplate($('#logPath').val()),
                    properties: ['openDirectory', 'createDirectory']
                },
                    function (fileNames) {
                        if (fileNames === undefined) {
                            return;
                        }
                        _settings.logPath = templatePath(fileNames[0]);
                        $('#logPath').val(_settings.logPath);
                    });
            });
        });

        function sortFiles(a, b) {
            return a.name.localeCompare(b.name);
        }

        function getThemes(p) {
            var p2 = parseTemplate(p);
            if (!existsSync(p2))
                return [];
            var themes = [];
            var files = fs.readdirSync(p2);
            for (var f = 0, fl = files.length; f < fl; f++) {
                if (path.extname(files[f]).toLowerCase() != '.css') continue;
                themes.push({
                    name: path.basename(files[f], path.extname(files[f])),
                    path: p
                });
            }
            return themes;
        }

        function loadThemes() {
            var themes = getThemes('{themes}');
            themes = themes.concat(getThemes(path.join('{data}', 'themes')));
            themes = themes.concat(getThemes(path.join('{documents}', 'jiMUD', 'themes')));
            themes.sort(sortFiles);
            $('#theme').append($('<option></option>').val(path.join('{themes}', 'default')).html('Default'));
            for (var t = 0, tl = themes.length; t < tl; t++) {
                if (themes[t].path === '{themes}' && themes[t].name === 'default') continue;
                $('#theme').append($('<option></option>').val(path.join(themes[t].path, themes[t].name)).html(themes[t].name[0].toUpperCase() + themes[t].name.substr(1)));
            }
            $('#theme').selectpicker('refresh');
        }

        // eslint-disable-next-line no-unused-vars
        function setValue(option, value) {
            if (value == 'false') value = false;
            if (value == 'true') value = true;
            if (value == 'null') value = null;
            if (value == 'undefined') value = undefined;
            if (typeof value == 'string' && parseFloat(value).toString() == value)
                value = parseFloat(value);
            option = option.split('-');
            if (option.length === 3)
                _settings[option[0]][option[1]][option[2]] = value;
            else if (option.length === 2)
                _settings[option[0]][option[1]] = value;
            else
                _settings[option[0]] = value;
        }

        function setSettings(obj, root) {
            let option;
            for (option in obj) {
                if (!obj.hasOwnProperty(option))
                    continue;
                if (typeof (obj[option]) === 'object') {
                    setSettings(obj[option], root + option + '-');
                    continue;
                }
                if (typeof (obj[option]) === 'string' || typeof (obj[option]) === 'number')
                    $('#' + root + option).val(obj[option]);
                else if (typeof (obj[option]) !== 'boolean')
                    continue;
                $('#' + root + option).prop('checked', obj[option]);
            }
        }

        function loadSettings() {
            setSettings(_settings, '');

            //$('#font').selectpicker('val', _settings.font);
            $('#font').val(_settings.font);
            $('#font').selectpicker('render');
            $('#fontSize').val(_settings.fontSize);
            $('#font').change();
            //$('#cmdfont').selectpicker('val', _settings.cmdfont);
            $('#cmdfont').val(_settings.font);
            $('#cmdfont').selectpicker('render');
            $('#cmdfontSize').val(_settings.cmdfontSize);
            $('#cmdfont').change();
            //$('#font').selectpicker('val', _settings.font);
            $('#chat-font').val(_settings.chat.font);
            $('#chat-font').selectpicker('render');
            $('#chat-fontSize').val(_settings.chat.fontSize);
            $('#chat-font').change();

            LoadColors();

            $('#MapperSplitArea').prop('checked', _settings.mapper.split);
            $('#mapFollow').prop('checked', _settings.mapper.follow);
            $('#mapEnabled').prop('checked', _settings.mapper.enabled);
            $('#mapLegend').prop('checked', _settings.mapper.legend);
            $('#MapperFillWalls').prop('checked', _settings.mapper.fill);

            $('#mapper-alwaysOnTop').prop('checked', _settings.mapper.alwaysOnTop);
            $('#mapper-memory').prop('checked', _settings.mapper.memory);
            $('#mapper-memorySavePeriod').val(_settings.mapper.memorySavePeriod);
            $('#mapper-alwaysOnTopClient').prop('checked', _settings.mapper.alwaysOnTopClient);

            $('#mapper-importTypeReplace').prop('checked', _settings.mapper.importType === 1);
            $('#mapper-importTypeMerge').prop('checked', _settings.mapper.importType === 0);

            $('#mapper-persistent').prop('checked', _settings.mapper.persistent);
            $('#chat-persistent').prop('checked', _settings.chat.persistent);
            $('#chat-gag').prop('checked', _settings.chat.gag);
            $('#chat-CaptureOnlyOpen').prop('checked', _settings.chat.CaptureOnlyOpen);

            $('#chat-alwaysOnTop').prop('checked', _settings.chat.alwaysOnTop);
            $('#chat-alwaysOnTopClient').prop('checked', _settings.chat.alwaysOnTopClient);
            $('#chat-captureLines').prop('checked', _settings.chat.captureLines);
            $('#chat-captureReviews').prop('checked', _settings.chat.captureReviews);
            $('#chat-captureTells').prop('checked', _settings.chat.captureTells);
            $('#chat-captureTalk').prop('checked', _settings.chat.captureTalk);
            $('#chat-captureAllLines').prop('checked', _settings.chat.captureAllLines);
            $('#chat-selective').prop('checked', !_settings.chat.captureAllLines);
            $('#chat-lines').prop('readonly', !_settings.chat.captureLines || _settings.chat.captureAllLines);
            $('#chat-selective').prop('disabled', !_settings.chat.captureLines);
            $('#chat-captureAllLines').prop('disabled', !_settings.chat.captureLines);

            $('#chat-lines').val(_settings.chat.lines.join(','));

            $('#backup-load-map').prop('checked', (_settings.backupLoad & 2) === 2);
            $('#backup-load-profiles').prop('checked', (_settings.backupLoad & 4) === 4);
            $('#backup-load-settings').prop('checked', (_settings.backupLoad & 8) === 8);

            $('#backup-save-map').prop('checked', (_settings.backupSave & 2) === 2);
            $('#backup-save-profiles').prop('checked', (_settings.backupSave & 4) === 4);
            $('#backup-save-settings').prop('checked', (_settings.backupSave & 8) === 8);

            $('#logWhat-html').prop('checked', (_settings.logWhat & 1) === 1);
            $('#logWhat-text').prop('checked', (_settings.logWhat & 2) === 2);
            $('#logWhat-raw').prop('checked', (_settings.logWhat & 4) === 4);

            $('#newlineShortcut-0').prop('checked', _settings.newlineShortcut === 0);
            $('#newlineShortcut-1').prop('checked', _settings.newlineShortcut === 1);
            $('#newlineShortcut-2').prop('checked', _settings.newlineShortcut === 2);
            $('#newlineShortcut-4').prop('checked', _settings.newlineShortcut === 4);
            $('#newlineShortcut-8').prop('checked', _settings.newlineShortcut === 8);

            $('#onDisconnect-0').prop('checked', _settings.onDisconnect === 0);
            $('#onDisconnect-1').prop('checked', _settings.onDisconnect === 1);
            $('#onDisconnect-2').prop('checked', _settings.onDisconnect === 2);
            $('#onDisconnect-4').prop('checked', _settings.onDisconnect === 4);
            $('#onDisconnect-8').prop('checked', _settings.onDisconnect === 8);

            $('#trayClick-none').prop('checked', _settings.trayClick === TrayClick.none);
            $('#trayClick-show').prop('checked', _settings.trayClick === TrayClick.show);
            $('#trayClick-hide').prop('checked', _settings.trayClick === TrayClick.hide);
            $('#trayClick-toggle').prop('checked', _settings.trayClick === TrayClick.toggle);
            $('#trayClick-menu').prop('checked', _settings.trayClick === TrayClick.menu);

            $('#trayDblClick-none').prop('checked', _settings.trayDblClick === TrayClick.none);
            $('#trayDblClick-show').prop('checked', _settings.trayDblClick === TrayClick.show);
            $('#trayDblClick-hide').prop('checked', _settings.trayDblClick === TrayClick.hide);
            $('#trayDblClick-toggle').prop('checked', _settings.trayDblClick === TrayClick.toggle);
            $('#trayDblClick-menu').prop('checked', _settings.trayDblClick === TrayClick.menu);

            $('.btn-group input').parent().removeClass('active');
            $('.btn-group input:checked').parent().addClass('active');

            $('#theme').val(_settings.theme);
            $('#theme').selectpicker('render');

            if (!_settings.windows['log-viewer'] || !_settings.windows['log-viewer'].options) {
                $('#logging-viewer-alwaysOnTopClient').prop('checked', true);
                $('#logging-viewer-alwaysOnTop').prop('checked', false);
                $('#logging-viewer-persistent').prop('checked', true);

            }
            else {
                $('#logging-viewer-alwaysOnTopClient').prop('checked', _settings.windows['log-viewer'].options.alwaysOnTopClient);
                $('#logging-viewer-alwaysOnTop').prop('checked', _settings.windows['log-viewer'].options.alwaysOnTop);
                $('#logging-viewer-persistent').prop('checked', _settings.windows['log-viewer'].options.persistent);
            }

            if (!_settings.extensions['log-viewer'])
                $('#logging-viewer-reopen').prop('checked', true);
            else
                $('#logging-viewer-reopen').prop('checked', _settings.extensions['log-viewer'].reopen);
        }

        function LoadColors() {
            $('#colorScheme').val('0');
            currentColors = _settings.colors.slice();
            var _colors = getColors();
            var c;
            for (c = 0; c < 16; c++)
                setColor('color' + c, currentColors[c] || _colors[c], true);
            for (c = 256; c < 280; c++)
                setColor('color' + c, currentColors[c] || _colors[c], true);
        }

        // eslint-disable-next-line no-unused-vars
        function resetSettings() {
            _settings = new Settings();
            if (!_settings.windows['log-viewer'] || !_settings.windows['log-viewer'].options)
                _settings.windows['log-viewer'].options = {
                    persistent: false,
                    alwaysOnTopClient: true,
                    alwaysOnTop: false
                };
            else {
                _settings.windows['log-viewer'].options.persistent = false;
                _settings.windows['log-viewer'].options.alwaysOnTopClient = true;
                _settings.windows['log-viewer'].options.alwaysOnTop = false;
            }
            if (!_settings.extensions['log-viewer'])
                _settings.extensions['log-viewer'] = {
                    'opened': [],
                    'browse': null,
                    'recent': [],
                    'reopen': true
                };
            loadSettings();
        }

        function setColor(id, color, noChange) {
            if (!color || typeof color === 'undefined' || color.length === 0) {
                $('#' + id).val('');
            }
            else {
                color = new RGBColor(color);
                if (!color.ok)
                    $('#' + id).val('');
                else
                    $('#' + id).val(color.toHex());
            }
            if (!noChange)
                $('#' + id).trigger('change');
        }

        function updateScheme(idx) {
            var _colors;
            var c;
            switch (idx) {
                case 0:
                    _colors = getColors();
                    for (c = 0; c < 16; c++)
                        setColor('color' + c, currentColors[c] || _colors[c]);
                    for (c = 256; c < 280; c++)
                        setColor('color' + c, currentColors[c] || _colors[c]);
                    break;
                case 2://Classic
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(128, 0, 0)');//red fore
                    setColor('color2', 'rgb(0, 128, 0)');//green fore
                    setColor('color3', 'rgb(128, 128, 0)');//yellow fore
                    setColor('color4', 'rgb(0, 0, 128)');//blue fore
                    setColor('color5', 'rgb(128, 0, 128)');//magenta fore
                    setColor('color6', 'rgb(0, 128, 128)');//cyan fore
                    setColor('color7', 'rgb(192, 192, 192)');//white fore
                    setColor('color8', 'rgb(128, 128, 128)');//black  bold
                    setColor('color9', 'rgb(255, 0, 0)'); //Red bold
                    setColor('color10', 'rgb(0, 255, 0)'); //green bold
                    setColor('color11', 'rgb(255, 255, 0)');//yellow bold
                    setColor('color12', 'rgb(0, 0, 255)');//blue bold
                    setColor('color13', 'rgb(255, 0, 255)');//magenta bold
                    setColor('color14', 'rgb(0, 255, 255)');//cyan bold
                    setColor('color15', 'rgb(255, 255, 255)');//white bold
                    setColor('color256', 'rgb(0, 0, 0)');//black faint
                    setColor('color257', 'rgb(118, 0, 0)');//red  faint
                    setColor('color258', 'rgb(0, 108, 0)');//green faint
                    setColor('color259', 'rgb(145, 136, 0)');//yellow faint
                    setColor('color260', 'rgb(0, 0, 108)');//blue faint
                    setColor('color261', 'rgb(108, 0, 108)');//magenta faint
                    setColor('color262', 'rgb(0, 108, 108)');//cyan faint
                    setColor('color263', 'rgb(160, 160, 160)');//white faint
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(128, 0, 0)');//red back
                    setColor('color266', 'rgb(0, 128, 0)');//greenback
                    setColor('color267', 'rgb(128, 128, 0)');//yellow back
                    setColor('color268', 'rgb(0, 0, 128)');//blue back
                    setColor('color269', 'rgb(128, 0, 128)');//magenta back
                    setColor('color270', 'rgb(0, 128, 128)');//cyan back
                    setColor('color271', 'rgb(192, 192, 192)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(0, 255, 255)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(255, 255, 0)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(192, 192, 192)');//DefaultFore
                    setColor('color278', 'rgb(128, 0, 0)');//ErrorFore
                    setColor('color279', 'rgb(192, 192, 192)');//ErrorBack
                    break;
                case 3://VGA
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(170, 0, 0)');//red fore
                    setColor('color2', 'rgb(0, 170, 0)');//green fore
                    setColor('color3', 'rgb(170, 85, 0)');//yellow fore
                    setColor('color4', 'rgb(0, 0, 170)');//blue fore
                    setColor('color5', 'rgb(170, 0, 170)');//magenta fore
                    setColor('color6', 'rgb(0, 170, 170)');//cyan fore
                    setColor('color7', 'rgb(170, 170, 170)');//white fore
                    setColor('color8', 'rgb(85, 85, 85)');//black  bold
                    setColor('color9', 'rgb(255, 85, 85)'); //Red bold
                    setColor('color10', 'rgb(85, 255, 85)'); //green bold
                    setColor('color11', 'rgb(255, 255, 85)');//yellow bold
                    setColor('color12', 'rgb(85, 85, 255)');//blue bold
                    setColor('color13', 'rgb(255, 85, 255)');//magenta bold
                    setColor('color14', 'rgb(85, 255, 255)');//cyan bold
                    setColor('color15', 'rgb(255, 255, 255)');//white bold
                    setColor('color256', 'rgb(0,0,0)');
                    setColor('color257', 'rgb(119,0,0)');
                    setColor('color258', 'rgb(0,119,0)');
                    setColor('color259', 'rgb(119,60,0)');
                    setColor('color260', 'rgb(0,0,119)');
                    setColor('color261', 'rgb(119,0,119)');
                    setColor('color262', 'rgb(0,119,119)');
                    setColor('color263', 'rgb(119,119,119)');
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(170, 0, 0)');//red back
                    setColor('color266', 'rgb(0, 170, 0)');//greenback
                    setColor('color267', 'rgb(170, 85, 0)');//yellow back
                    setColor('color268', 'rgb(0, 0, 170)');//blue back
                    setColor('color269', 'rgb(170, 0, 170)');//magenta back
                    setColor('color270', 'rgb(0, 170, 170)');//cyan back
                    setColor('color271', 'rgb(170, 170, 170)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(85, 255, 255)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(255, 255, 85)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(170, 170, 170)');//DefaultFore
                    setColor('color278', 'rgb(170, 0, 0)');//ErrorFore
                    setColor('color279', 'rgb(170, 170, 170)');//ErrorBack
                    break;
                case 4://Terminal.app
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(194, 54, 33)');//red fore
                    setColor('color2', 'rgb(37, 188, 36)');//green fore
                    setColor('color3', 'rgb(173, 173, 39)');//yellow fore
                    setColor('color4', 'rgb(73, 46, 225)');//blue fore
                    setColor('color5', 'rgb(211, 56, 211)');//magenta fore
                    setColor('color6', 'rgb(51, 187, 200)');//cyan fore
                    setColor('color7', 'rgb(203, 204, 205)');//white fore
                    setColor('color8', 'rgb(129, 131, 131)');//black  bold
                    setColor('color9', 'rgb(252,57,31)'); //Red bold
                    setColor('color10', 'rgb(49, 231, 34)'); //green bold
                    setColor('color11', 'rgb(234, 236, 35)');//yellow bold
                    setColor('color12', 'rgb(88, 51, 255)');//blue bold
                    setColor('color13', 'rgb(249, 53, 248)');//magenta bold
                    setColor('color14', 'rgb(20, 240, 240)');//cyan bold
                    setColor('color15', 'rgb(233, 235, 235)');//white bold
                    setColor('color256', 'rgb(0,0,0)');
                    setColor('color257', 'rgb(136,38,24)');
                    setColor('color258', 'rgb(26,132,26)');
                    setColor('color259', 'rgb(122,122,28)');
                    setColor('color260', 'rgb(52,33,158)');
                    setColor('color261', 'rgb(148,40,148)');
                    setColor('color262', 'rgb(36,131,140)');
                    setColor('color263', 'rgb(143,143,144)');
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(194, 54, 33)');//red back
                    setColor('color266', 'rgb(37, 188, 36)');//greenback
                    setColor('color267', 'rgb(173, 173, 39)');//yellow back
                    setColor('color268', 'rgb(73, 46, 225)');//blue back
                    setColor('color269', 'rgb(211, 56, 211)');//magenta back
                    setColor('color270', 'rgb(51, 187, 200)');//cyan back
                    setColor('color271', 'rgb(203, 204, 205)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(20, 240, 240)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(234, 236, 35)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(203, 204, 205)');//DefaultFore
                    setColor('color278', 'rgb(194, 54, 33)');//ErrorFore
                    setColor('color279', 'rgb(203, 204, 205)');//ErrorBack
                    break;
                case 5://PuTTY
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(187, 0, 0)');//red fore
                    setColor('color2', 'rgb(0, 187, 0)');//green fore
                    setColor('color3', 'rgb(187, 187, 0)');//yellow fore
                    setColor('color4', 'rgb(0, 0, 187)');//blue fore
                    setColor('color5', 'rgb(187, 0, 187)');//magenta fore
                    setColor('color6', 'rgb(0, 187, 187)');//cyan fore
                    setColor('color7', 'rgb(187, 187, 187)');//white fore
                    setColor('color8', 'rgb(85, 85, 85)');//black  bold
                    setColor('color9', 'rgb(255, 85, 85)'); //Red bold
                    setColor('color10', 'rgb(85, 255, 85)'); //green bold
                    setColor('color11', 'rgb(255, 255, 85)');//yellow bold
                    setColor('color12', 'rgb(85, 85, 255)');//blue bold
                    setColor('color13', 'rgb(255, 85, 255)');//magenta bold
                    setColor('color14', 'rgb(85, 255, 255)');//cyan bold
                    setColor('color15', 'rgb(255, 255, 255)');//white bold
                    setColor('color256', 'rgb(0,0,0)');
                    setColor('color257', 'rgb(131,0,0)');
                    setColor('color258', 'rgb(0,131,0)');
                    setColor('color259', 'rgb(131,131,0)');
                    setColor('color260', 'rgb(0,0,131)');
                    setColor('color261', 'rgb(131,0,131)');
                    setColor('color262', 'rgb(0,131,131)');
                    setColor('color263', 'rgb(131,131,131)');
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(187, 0, 0)');//red back
                    setColor('color266', 'rgb(0, 187, 0)');//greenback
                    setColor('color267', 'rgb(187, 187, 0)');//yellow back
                    setColor('color268', 'rgb(0, 0, 187)');//blue back
                    setColor('color269', 'rgb(187, 0, 187)');//magenta back
                    setColor('color270', 'rgb(0, 187, 187)');//cyan back
                    setColor('color271', 'rgb(187, 187, 187)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(85, 255, 255)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(255, 255, 85)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(187, 187, 187)');//DefaultFore
                    setColor('color278', 'rgb(187, 0, 0)');//ErrorFore
                    setColor('color279', 'rgb(187, 187, 187)');//ErrorBack
                    break;
                case 6://mIRC
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(127, 0, 0)');//red fore
                    setColor('color2', 'rgb(0, 147, 0)');//green fore
                    setColor('color3', 'rgb(252, 127, 0)');//yellow fore
                    setColor('color4', 'rgb(0, 0, 127)');//blue fore
                    setColor('color5', 'rgb(156, 0, 156)');//magenta fore
                    setColor('color6', 'rgb(0, 147, 147)');//cyan fore
                    setColor('color7', 'rgb(210, 210, 210)');//white fore
                    setColor('color8', 'rgb(127, 127, 127)');//black  bold
                    setColor('color9', 'rgb(255, 0, 0)'); //Red bold
                    setColor('color10', 'rgb(0, 252, 0)'); //green bold
                    setColor('color11', 'rgb(255, 255, 0)');//yellow bold
                    setColor('color12', 'rgb(0, 0, 252)');//blue bold
                    setColor('color13', 'rgb(255, 0, 255)');//magenta bold
                    setColor('color14', 'rgb(0, 255, 255)');//cyan bold
                    setColor('color15', 'rgb(255, 255, 255)');//white bold
                    setColor('color256', 'rgb(0,0,0)');
                    setColor('color257', 'rgb(89,0,0)');
                    setColor('color258', 'rgb(0,103,0)');
                    setColor('color259', 'rgb(177,89,0)');
                    setColor('color260', 'rgb(0,0,89)');
                    setColor('color261', 'rgb(110,0,110)');
                    setColor('color262', 'rgb(0,103,103)');
                    setColor('color263', 'rgb(147,147,147)');
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(127, 0, 0)');//red back
                    setColor('color266', 'rgb(0, 147, 0)');//greenback
                    setColor('color267', 'rgb(252, 127, 0)');//yellow back
                    setColor('color268', 'rgb(0, 0, 127)');//blue back
                    setColor('color269', 'rgb(156, 0, 156)');//magenta back
                    setColor('color270', 'rgb(0, 147, 147)');//cyan back
                    setColor('color271', 'rgb(210, 210, 210)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(0, 255, 255)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(255, 255, 0)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(210, 210, 210)');//DefaultFore
                    setColor('color278', 'rgb(127, 0, 0)');//ErrorFore
                    setColor('color279', 'rgb(210, 210, 210)');//ErrorBack
                    break;
                case 7://xterm
                    setColor('color0', 'rgb(0,0,0)'); //black fore
                    setColor('color1', 'rgb(205, 0, 0)');//red fore
                    setColor('color2', 'rgb(0, 205, 0)');//green fore
                    setColor('color3', 'rgb(205, 205, 0)');//yellow fore
                    setColor('color4', 'rgb(0, 0, 238)');//blue fore
                    setColor('color5', 'rgb(205, 0, 205)');//magenta fore
                    setColor('color6', 'rgb(0, 205, 205)');//cyan fore
                    setColor('color7', 'rgb(229, 229, 229)');//white fore
                    setColor('color8', 'rgb(127, 127, 127)');//black  bold
                    setColor('color9', 'rgb(255, 0, 0)'); //Red bold
                    setColor('color10', 'rgb(0, 255, 0)'); //green bold
                    setColor('color11', 'rgb(255, 255, 0)');//yellow bold
                    setColor('color12', 'rgb(92, 92, 255)');//blue bold
                    setColor('color13', 'rgb(255, 0, 255)');//magenta bold
                    setColor('color14', 'rgb(0, 255, 255)');//cyan bold
                    setColor('color15', 'rgb(255, 255, 255)');//white bold
                    setColor('color256', 'rgb(0,0,0)');
                    setColor('color257', 'rgb(144,0,0)');
                    setColor('color258', 'rgb(0,144,0)');
                    setColor('color259', 'rgb(144,144,0)');
                    setColor('color260', 'rgb(0,0,167)');
                    setColor('color261', 'rgb(144,0,144)');
                    setColor('color262', 'rgb(0,144,144)');
                    setColor('color263', 'rgb(161,161,161)');
                    setColor('color264', 'rgb(0, 0, 0)'); //BackgroundBlack
                    setColor('color265', 'rgb(205, 0, 0)');//red back
                    setColor('color266', 'rgb(0, 205, 0)');//greenback
                    setColor('color267', 'rgb(205, 205, 0)');//yellow back
                    setColor('color268', 'rgb(0, 0, 238)');//blue back
                    setColor('color269', 'rgb(205, 0, 205)');//magenta back
                    setColor('color270', 'rgb(0, 205, 205)');//cyan back
                    setColor('color271', 'rgb(229, 229, 229)');//white back
                    setColor('color272', 'rgb(0,0,0)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(0, 255, 255)');//iceMudInfoText
                    setColor('color274', 'rgb(0,0,0)'); //LocalEchoBackground
                    setColor('color275', 'rgb(255, 255, 0)');//LocalEchoText
                    setColor('color276', 'rgb(0, 0, 0)');//DefaultBack
                    setColor('color277', 'rgb(229, 229, 229)');//DefaultFore
                    setColor('color278', 'rgb(205, 0, 0)');//ErrorFore
                    setColor('color279', 'rgb(229, 229, 229)');//ErrorBack
                    break;
                case 8: //Win 10
                    setColor('color0', 'rgb(12,12,12)'); //black fore
                    setColor('color1', 'rgb(197,15,31)');//red fore
                    setColor('color2', 'rgb(19,161,14)');//green fore
                    setColor('color3', 'rgb(193,156,0)');//yellow fore
                    setColor('color4', 'rgb(0,55,218)');//blue fore
                    setColor('color5', 'rgb(136,23,152)');//magenta fore
                    setColor('color6', 'rgb(58,150,221)');//cyan fore
                    setColor('color7', 'rgb(204,204,204)');//white fore
                    setColor('color8', 'rgb(118,118,118)');//black  bold
                    setColor('color9', 'rgb(231,72,86)'); //Red bold
                    setColor('color10', 'rgb(22,198,12)'); //green bold
                    setColor('color11', 'rgb(249,241,165)');//yellow bold
                    setColor('color12', 'rgb(59,120,255)');//blue bold
                    setColor('color13', 'rgb(180,0,158)');//magenta bold
                    setColor('color14', 'rgb(97,214,214)');//cyan bold
                    setColor('color15', 'rgb(242,242,242)');//white bold
                    setColor('color256', 'rgb(12,12,12)');//black faint
                    setColor('color257', 'rgb(99, 8, 15)');//red  faint
                    setColor('color258', 'rgb(10, 81, 7)');//green faint
                    setColor('color259', 'rgb(97, 78, 0)');//yellow faint
                    setColor('color260', 'rgb(0, 28, 109)');//blue faint
                    setColor('color261', 'rgb(68, 12, 76)');//magenta faint
                    setColor('color262', 'rgb(29, 75, 111)');//cyan faint
                    setColor('color263', 'rgb(102, 102, 102)');//white faint
                    setColor('color264', 'rgb(12,12,12)'); //BackgroundBlack
                    setColor('color265', 'rgb(197,15,31)');//red back
                    setColor('color266', 'rgb(19,161,14)');//greenback
                    setColor('color267', 'rgb(193,156,0)');//yellow back
                    setColor('color268', 'rgb(0,55,218)');//blue back
                    setColor('color269', 'rgb(136,23,152)');//magenta back
                    setColor('color270', 'rgb(58,150,221)');//cyan back
                    setColor('color271', 'rgb(204,204,204)');//white back
                    setColor('color272', 'rgb(12,12,12)'); //iceMudInfoBackground
                    setColor('color273', 'rgb(97,214,214)');//iceMudInfoText
                    setColor('color274', 'rgb(12,12,12)'); //LocalEchoBackground
                    setColor('color275', 'rgb(249,241,165)');//LocalEchoText
                    setColor('color276', 'rgb(12,12,12)');//DefaultBack
                    setColor('color277', 'rgb(204,204,204)');//DefaultFore
                    setColor('color278', 'rgb(197,15,31)');//ErrorFore
                    setColor('color279', 'rgb(204,204,204)');//ErrorBack
                    break;
                default:
                    _colors = getColors();
                    for (c = 0; c < 16; c++)
                        setColor('color' + c, _colors[c]);
                    for (c = 256; c < 280; c++)
                        setColor('color' + c, _colors[c]);
                    break;
            }
        }

        // eslint-disable-next-line no-unused-vars
        function saveSettings() {
            _settings.chat.lines = $('#chat-lines').val().split(',');
            _settings.save(remote.getGlobal('settingsFile'));
            ipcRenderer.send('reload-options', false);
            window.close();
        }

        // eslint-disable-next-line no-unused-vars
        function backup() {
            var file = dialog.showSaveDialog(remote.getCurrentWindow(), {
                title: 'Save as...',
                defaultPath: path.join(parseTemplate('{documents}'), 'jiMUD-data.zip'),
                filters: [
                    { name: 'Zip files (*.zip)', extensions: ['zip'] },
                    { name: 'All files (*.*)', extensions: ['*'] },
                ]
            });
            if (file === undefined)
                return;

            showProgressDialog();
            archiver = archiver || require('yazl');
            var data = parseTemplate('{data}');
            archive = new archiver.ZipFile();

            if (isFileSync(path.join(data, 'characters.json')))
                archive.addFile(path.join(data, 'characters.json'), 'characters.json');
            if (isFileSync(path.join(data, 'map.sqlite')))
                archive.addFile(path.join(data, 'map.sqlite'), 'map.sqlite');
            if (isFileSync(path.join(data, 'mail.sqlite')))
                archive.addFile(path.join(data, 'mail.sqlite'), 'mail.sqlite');
            if (isFileSync(path.join(data, 'settings.json')))
                archive.addFile(path.join(data, 'settings.json'), 'settings.json');
            if (isFileSync(path.join(data, 'editor.json')))
                archive.addFile(path.join(data, 'editor.json'), 'editor.json');
            var files;
            if (isDirSync(path.join(data, 'profiles'))) {
                files = walkSync(path.join(data, 'profiles'));
                files.files.forEach(file => {
                    archive.addFile(file, file.substring(data.length + 1).replace(/\\/g, '/'));
                });
            }
            if (isDirSync(path.join(data, 'characters'))) {
                files = walkSync(path.join(data, 'characters'));
                files.files.forEach(file => {
                    archive.addFile(file, file.substring(data.length + 1).replace(/\\/g, '/'));
                });
            }

            archive.outputStream.pipe(fs.createWriteStream(file)).on('close', function () {
                closeProgressDialog();
            });
            archive.end(() => {
                closeProgressDialog();
            });
        }

        function showProgressDialog() {
            var progress = document.getElementById('progress-dialog');
            if (progress.open) return;
            setProgressDialogValue(0);
            progress.showModal();
        }

        function setProgressDialogValue(value) {
            ipcRenderer.send('set-progress', { value: value });
            ipcRenderer.send('set-progress-window', 'code-editor', { value: value });
            document.getElementById('progress-dialog-progressbar').value = value * 100;
        }

        function closeProgressDialog() {
            var progress = document.getElementById('progress-dialog');
            if (progress.open)
                progress.close();
            setProgressDialogValue(-1);
            document.getElementById('progress-dialog-progressbar').removeAttribute('value');
            archive = null;
        }

        // eslint-disable-next-line no-unused-vars
        function cancelProgress() {
            if (archive)
                archive.abort();
            closeProgressDialog();
        }
    </script>
</head>

<body>
    <div class="dialog-body">
        <div id="pref-tree" class="panel panel-default"></div>
        <div id="content" class="panel panel-default">
            <div class="panel-heading">
                <span id="pref-title">General</span>
            </div>
            <div class="panel-body" id="pref-editor">
                <div role="tabpanel" class="pref-pane" id="general">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="autoConnect" /> Auto connect on load
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Auto connect delay
                            <div class="input-group">
                                <input type="number" id="autoConnectDelay" class="input-sm form-control" min="0" max="10000" />
                                <div class="input-group-addon">ms</div>
                            </div>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="autoCreateCharacter" /> Auto create character
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="autoLogin" /> Auto login
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="showCharacterManager" /> Show character manager on load
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="spellchecking" /> Enable spellchecking
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="editorPersistent" /> Persistent advanced editor
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">Theme
                            <select id="theme" data-container="body" class="form-control selectpicker" data-width="150px"></select>
                        </label>
                    </div>
                    <div class="col-sm-12 form-group">
                        <label class="control-label">On disconnect do</label>
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="onDisconnect" id="onDisconnect-0"> Nothing
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="onDisconnect" id="onDisconnect-1"> Reconnect
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="onDisconnect" id="onDisconnect-2"> Reconnect dialog
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="onDisconnect" id="onDisconnect-4"> Character manager
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="onDisconnect" id="onDisconnect-8"> Close
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="checkForUpdates" /> Check for updates on load
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableSound" /> Enable sound
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="display">
                    <div class="col-sm-6 fform-group">
                        <label class="control-label">
                            Buffer size
                            <input type="number" id="bufferSize" class="input-sm form-control" min="100" max="1000000" />
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="AutoCopySelectedToClipboard" /> Auto copy selected to clipboard
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="commandEcho" /> Echo commands
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableURLDetection" /> Enable URL detection
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="CommandonClick" /> Focus command input on click
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="flashing" /> Enable flashing text
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-roundedOverlays" /> Enable rounded overlays
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-split" /> Split scroll
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-splitLive" /> Split scroll live update
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-hideTrailingEmptyLine" /> Hide trailing line
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-showSplitButton" /> Show split button
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-enableColors" /> Enable colors
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="display-enableBackgroundColors" /> Enable background colors
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="display-fonts">
                    <div class="col-sm-12 form-group">
                        <label class="control-label" style="width: 100%;">Font
                            <br>
                            <select id="font" class="form-control selectpicker" data-container="body" data-width="100%">
                                <optgroup label="Basic">
                                    <option value="'Courier New', Courier, monospace">'Courier New', Courier, monospace</option>
                                    <option value="'Lucida Console', Monaco, monospace">'Lucida Console', Monaco, monospace</option>
                                    <option value="Georgia, serif">Georgia, serif</option>
                                    <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">'Palatino Linotype', 'Book Antiqua', Palatino, serif</option>
                                    <option value="'Times New Roman', Times, serif">'Times New Roman', Times, serif</option>
                                    <option value="Arial, Helvetica, sans-serif">Arial, Helvetica, sans-serif</option>
                                    <option value="'Arial Black', Gadget, sans-serif">'Arial Black', Gadget, sans-serif</option>
                                    <option value="'Comic Sans MS', cursive, sans-serif">'Comic Sans MS', cursive, sans-serif</option>
                                    <option value="Impact, Charcoal, sans-serif">Impact, Charcoal, sans-serif</option>
                                    <option value="'Lucida Sans Unicode', 'Lucida Grande', sans-serif">'Lucida Sans Unicode', 'Lucida Grande', sans-serif</option>
                                    <option value="Tahoma, Geneva, sans-serif">Tahoma, Geneva, sans-serif</option>
                                    <option value="'Trebuchet MS', Helvetica, sans-serif">'Trebuchet MS', Helvetica, sans-serif</option>
                                    <option value="Verdana, Geneva, sans-serif ">Verdana, Geneva, sans-serif </option>
                                </optgroup>
                                <optgroup id="font-system" label="System">
                                </optgroup>
                            </select>
                        </label>
                    </div>
                    <div class="col-sm-12 form-group">
                        <label class="control-label" style="width: 100%;">Font size
                            <input type="text" class="input-sm form-control" id="fontSize" style="width: 100" />
                        </label>
                    </div>
                    <div class="col-sm-12 form-group">
                        <label class="control-label" style="width: 100%;">Font sample
                            <div id="font-sample" style="margin: 0px; padding: 2px;font-size: 24pt;height:1.5em;width:100%;overflow:hidden;">ABCDEFGHIJKLMNOPQRSTUVWXYZ</div>
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="colors">
                    <div class="col-sm-4 form-group">
                        <label>Color scheme
                            <select id="colorScheme" style="width:100%" name="colorScheme" class="form-control selectpicker" data-container="body" data-width="100%">
                                <option value="0">Current</option>
                                <option value="1">Default</option>
                                <option value="2">Classic</option>
                                <option value="3">VGA</option>
                                <option value="4">Terminal.app</option>
                                <option value="5">PuTTY</option>
                                <option value="6">mIRC</option>
                                <option value="7">xterm</option>
                                <option value="8">Windows 10</option>
                            </select>
                        </label>
                        <div class="col-sm-12 form-group" style="text-align:center">
                            <div>
                                <div class="col-sm-4"></div>
                                <div class="col-sm-4">Fore</div>
                                <div class="col-sm-4">Back</div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Default</div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color277">
                                </div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color276">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Echo</div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color275">
                                </div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color274">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Info</div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color273">
                                </div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color272">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Error</div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color278">
                                </div>
                                <div class="col-sm-4">
                                    <input type="color" class="input-sm form-control" id="color279">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-8 form-group">
                        <div class="col-sm-12 form-group" style="text-align:center">
                            <div>
                                <div class="col-sm-4"></div>
                                <div class="col-sm-2">Fore</div>
                                <div class="col-sm-2">Back</div>
                                <div class="col-sm-2">Bold</div>
                                <div class="col-sm-2">Faint</div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Black</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color0">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color264">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color8">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color256">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Red</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color1">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color265">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color9">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color257">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Green</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color2">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color266">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color10">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color258">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Yellow</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color3">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color267">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color11">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color259">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Blue</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color4">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color268">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color12">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color260">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Magenta</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color5">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color269">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color13">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color261">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">Cyan</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color6">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color270">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color14">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color262">
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-4" style="text-align:left">White</div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color7">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color271">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color15">
                                </div>
                                <div class="col-sm-2">
                                    <input type="color" class="input-sm form-control" id="color263">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="command-line">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="control-label">Font
                                <br>
                                <select id="cmdfont" class="form-control selectpicker" data-container="body" data-width="250px">
                                    <optgroup label="Basic">
                                        <option value="'Courier New', Courier, monospace">'Courier New', Courier, monospace</option>
                                        <option value="'Lucida Console', Monaco, monospace">'Lucida Console', Monaco, monospace</option>
                                        <option value="Georgia, serif">Georgia, serif</option>
                                        <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">'Palatino Linotype', 'Book Antiqua', Palatino, serif</option>
                                        <option value="'Times New Roman', Times, serif">'Times New Roman', Times, serif</option>
                                        <option value="Arial, Helvetica, sans-serif">Arial, Helvetica, sans-serif</option>
                                        <option value="'Arial Black', Gadget, sans-serif">'Arial Black', Gadget, sans-serif</option>
                                        <option value="'Comic Sans MS', cursive, sans-serif">'Comic Sans MS', cursive, sans-serif</option>
                                        <option value="Impact, Charcoal, sans-serif">Impact, Charcoal, sans-serif</option>
                                        <option value="'Lucida Sans Unicode', 'Lucida Grande', sans-serif">'Lucida Sans Unicode', 'Lucida Grande', sans-serif</option>
                                        <option value="Tahoma, Geneva, sans-serif">Tahoma, Geneva, sans-serif</option>
                                        <option value="'Trebuchet MS', Helvetica, sans-serif">'Trebuchet MS', Helvetica, sans-serif</option>
                                        <option value="Verdana, Geneva, sans-serif ">Verdana, Geneva, sans-serif </option>
                                    </optgroup>
                                    <optgroup id="cmdfont-system" label="System">
                                    </optgroup>
                                </select>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Font size
                                <input type="text" class="input-sm form-control" id="cmdfontSize" style="width: 252px" />
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Font sample
                                <div id="cmd-font-sample" style="margin: 0px; padding: 2px;font-size: 24pt;height:1.5em;width:100%;overflow:hidden;">ABCDEFGHIJKLMNOPQRSTUVWXYZ</div>
                            </label>
                        </div>

                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            History size
                            <input type="number" id="commandHistorySize" class="input-sm form-control" min="1" max="2000" style="width: 100px" />
                        </label>
                    </div>


                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="keepLastCommand" /> Keep last command
                        </label>
                    </div>
                    <div class="col-sm-12 form-group">
                        <label class="control-label">Newline shotcut</label>
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="newlineShortcut" id="newlineShortcut-0"> None
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="newlineShortcut" id="newlineShortcut-1"> Ctrl + Enter
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="newlineShortcut" id="newlineShortcut-2"> Shift + Enter
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="newlineShortcut" id="newlineShortcut-4"> (Ctrl | Shift) + Enter
                            </label>
                            <label class="btn btn-default btn-xs">
                                <input type="radio" name="newlineShortcut" id="newlineShortcut-8"> Ctrl + Shift + Enter
                            </label>

                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="logging">

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logEnabled" /> Enable logging
                        </label>
                    </div>


                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logPrepend" /> Pre-pend current buffer to log
                        </label>
                    </div>


                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logOffline" /> Enable logging of offline text
                        </label>
                    </div>


                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logUniqueOnConnect" /> Create log for every connection
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logEnabled" /> Log gagged lines
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">Log what</label>
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-xs">
                                <input type="checkbox" id="logWhat-html"> HTML
                            </label>
                            <label class="btn btn-default btn-xs active">
                                <input type="checkbox" id="logWhat-text"> Text
                            </label>
                            <label class="btn btn-default btn-xs active">
                                <input type="checkbox" id="logWhat-raw"> Raw
                            </label>
                        </div>
                        <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">If all are disabled will default to text</span>
                    </div>

                    <div class="col-sm-12 form-group">
                        <label class="control-label" style="width:100%">
                            Date/time format
                            <input type="text" id="logTimeFormat" style="width:100%" class="input-sm form-control" />
                        </label>
                        <span class="help-block" style="float: left;font-size: 0.8em;margin:0;padding:0">Supports all moment time formats</span>
                    </div>

                    <div class="col-sm-12 form-group">
                        <label class="control-label" style="width:100%">
                            Save path
                            <div class="input-group">
                                <input type="text" id="logPath" style="width:100%" class="input-sm form-control" />
                                <span class="input-group-btn">
                                    <button class="btn btn-default btn-sm" type="button" id="btn-logPath">
                                        &hellip;
                                    </button>
                                </span>
                            </div>
                        </label>
                    </div>

                </div>
                <div role="tabpanel" class="pref-pane" id="logging-viewer">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logging-viewer-reopen" /> Remember opened files on reload
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logging-viewer-alwaysOnTopClient" /> Always on top of the main window
                            <span class="win32 help-block" style="display:none;float: left;font-size: 0.8em;margin:0;padding:0">Requires restart on windows</span>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logging-viewer-alwaysOnTop" /> Always on top of all windows
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logging-viewer-persistent" /> Persistent
                        </label>
                    </div>

                </div>
                <div role="tabpanel" class="pref-pane" id="mapper">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="mapEnabled" /> Enable mapper
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="mapFollow" /> Follow player
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="mapLegend" /> Show legend
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="MapperSplitArea" /> Split areas
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="MapperFillWalls" /> Display walls
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="mapper-memory" /> Load in memory
                            <!--span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Requires restart</span-->
                        </label>
                    </div>
                    <div class="col-sm-6  form-group">
                        <label class="control-label">
                            <!--span class="help-block" style="float:right;font-size: 0.8em;margin:0;padding:0">Requires restart</span-->
                            Save period
                            <div class="input-group">
                                <input type="number" id="mapper-memorySavePeriod" class="input-sm form-control" min="60000" />
                                <div class="input-group-addon">ms</div>
                            </div>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">Default Import Type</label>
                        <div>
                            <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="mapper-importType" id="mapper-importTypeMerge"> Merge
                                </label>
                                <label class="btn btn-default btn-xs active">
                                    <input type="radio" name="mapper-importType" id="mapper-importTypeReplace" checked> Replace
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                Delay between directions
                                <div class="input-group">
                                    <input type="number" id="commandDelay" class="input-sm form-control" />
                                    <div class="input-group-addon">ms</div>
                                </div>
                            </label>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                Directions to send
                                <input type="number" id="commandDelayCount" class="input-sm form-control" />
                            </label>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="mapper-window">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="showMapper" /> Open on load
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="mapper-persistent" /> Persistent
                        </label>
                    </div>
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="mapper-alwaysOnTopClient" /> Always on top of the main window
                                <span class="win32 help-block" style="display:none;float: left;font-size: 0.8em;margin:0;padding:0">Requires restart on windows</span>
                            </label>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="mapper-alwaysOnTop" /> Always on top of all windows
                            </label>
                        </div>
                    </div>

                </div>
                <div role="tabpanel" class="pref-pane" id="chat">
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="chat-captureTells" /> Capture tells
                                <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Tell, emoteto, and shouts</span>
                            </label>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="chat-captureTalk" /> Capture talk
                                <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Say, yell, whisper and speak</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="chat-captureReviews" /> Capture reviews
                                <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Captures based on enabled captures</span>
                            </label>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="chat-gag" /> Gag
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-CaptureOnlyOpen" /> Capture only when open
                        </label>
                    </div>
                    <hr>
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-3 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="chat-captureLines" /> Capture lines
                            </label>
                            <br>
                            <label class="control-label">
                                <input type="radio" name="lines" id="chat-captureAllLines" /> All
                            </label>
                            <br>
                            <label class="control-label">
                                <input type="radio" name="lines" id="chat-selective" /> Selective
                            </label>
                        </div>
                        <div class="col-sm-9 form-group">
                            <div class="form-group">
                                <label class="control-label" style="width: 100%">Selective Lines
                                    <textarea class="input-sm form-control" id="chat-lines" style="width: 100%"></textarea>
                                    <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Case sensitive and separate each name with a comma(,) for example: Chat,Rp</span>
                                </label>
                            </div>
                        </div>
                    </div>

                </div>
                <div role="tabpanel" class="pref-pane" id="chat-display">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="control-label">Font
                                <br>
                                <select id="chat-font" class="form-control selectpicker" data-container="body" data-width="250px">
                                    <optgroup label="Basic">
                                        <option value="'Courier New', Courier, monospace">'Courier New', Courier, monospace</option>
                                        <option value="'Lucida Console', Monaco, monospace">'Lucida Console', Monaco, monospace</option>
                                        <option value="Georgia, serif">Georgia, serif</option>
                                        <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">'Palatino Linotype', 'Book Antiqua', Palatino, serif</option>
                                        <option value="'Times New Roman', Times, serif">'Times New Roman', Times, serif</option>
                                        <option value="Arial, Helvetica, sans-serif">Arial, Helvetica, sans-serif</option>
                                        <option value="'Arial Black', Gadget, sans-serif">'Arial Black', Gadget, sans-serif</option>
                                        <option value="'Comic Sans MS', cursive, sans-serif">'Comic Sans MS', cursive, sans-serif</option>
                                        <option value="Impact, Charcoal, sans-serif">Impact, Charcoal, sans-serif</option>
                                        <option value="'Lucida Sans Unicode', 'Lucida Grande', sans-serif">'Lucida Sans Unicode', 'Lucida Grande', sans-serif</option>
                                        <option value="Tahoma, Geneva, sans-serif">Tahoma, Geneva, sans-serif</option>
                                        <option value="'Trebuchet MS', Helvetica, sans-serif">'Trebuchet MS', Helvetica, sans-serif</option>
                                        <option value="Verdana, Geneva, sans-serif ">Verdana, Geneva, sans-serif </option>
                                    </optgroup>
                                    <optgroup id="chat-font-system" label="System">
                                    </optgroup>
                                </select>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Font size
                                <input type="text" class="input-sm form-control" id="chat-fontSize" style="width: 252px" />
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Font sample
                                <div id="chat-font-sample" style="margin: 0px; padding: 2px;font-size: 24pt;height:1.5em;width:100%;overflow:hidden;">ABCDEFGHIJKLMNOPQRSTUVWXYZ</div>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label">
                            Buffer size
                            <input type="number" id="chat-bufferSize" class="input-sm form-control" min="100" max="1000000" />
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-flashing" /> Enable flashing text
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-roundedOverlays" /> Enable rounded overlays
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-split" /> Split scroll
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-splitLive" /> Split scroll live update
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-showSplitButton" /> Show split button
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="chat-window">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-alwaysOnTopClient" /> Always on top of the main window
                            <span class="win32 help-block" style="display:none;float: left;font-size: 0.8em;margin:0;padding:0">Requires restart on windows</span>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-alwaysOnTop" /> Always on top of all windows
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="chat-persistent" /> Persistent
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="telnet">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableMCCP" /> MUD Compression Protocol (MCCP)
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableUTF8" /> UTF-8
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableMXP" /> MUD eXtension Protocol (MXP)
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableEcho" /> Echo
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableMSP" /> MUD Sound Protocol (MSP)
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="notifyMSPPlay" /> Display Notification on MSP Play
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="status">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="lagMeter" /> Show lag meter
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enablePing" /> Enable GMCP ping for lag meter
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="statusExperienceNeededProgressbar" /> Show Experience Needed as Progressbar
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="allowNegativeNumberNeeded" /> Allow negative number for experience needed
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="scripting">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="allowEval" /> Allow evaluate
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="showScriptErrors" /> Show script errors
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="parseSingleQuotes" /> Parse single quotes as string
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="parseDoubleQuotes" /> Parse double quotes as string
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="advanced">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="dev" /> Connect to development
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="gamepads" /> Enable gamepads
                            <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Experimental</span>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="enableDebug" /> Enable debug
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="logErrors" /> Log errors
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="showErrorsExtended" /> Show extended error messages
                        </label>
                    </div>
                    <div class="col-sm-12 form-group" style="padding: 0px;">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                <input type="checkbox" id="enableKeepAlive" /> Enable Keep alive
                            </label>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">
                                Keep alive delay
                                <div class="input-group">
                                    <input type="number" id="keepAliveDelay" class="input-sm form-control" min="0" max="10000" />
                                    <div class="input-group-addon">s</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="col-sm-12 form-group" style="padding: 0px;">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Backup save</label>
                            <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-save-settings"> Settings
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-save-profiles"> Profiles
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-save-map"> Map
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Backup load</label>
                            <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-load-settings"> Settings
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-load-profiles"> Profiles
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="checkbox" id="backup-load-map"> Map
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="backupAllProfiles" /> Backup all profiles
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="hideOnMinimize" /> Hide when minimized
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="profiles-codeEditor" /> Enable profile manager code editor
                        </label>
                        <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Must close and reopen profile manger</span>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="profiles-watchFiles" /> Enable profile manager file watcher
                        </label>
                        <span class="help-block" style="font-size: 0.8em;margin:0;padding:0">Must close and reopen profile manger</span>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="askonclose" /> Enable warning dialog when connected and closing client
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="askonchildren" /> Enable warning dialog when closing client and child windows are open
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="askonloadCharacter" /> Enable warning dialog when loading a character from manager
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="tray">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            <input type="checkbox" id="showTrayIcon" /> Show tray icon
                        </label>
                    </div>
                    <div class="col-sm-12 form-group" style="margin:0;padding:0">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Tray icon single click</label>
                            <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayClick" id="trayClick-none"> None
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayClick" id="trayClick-show"> Show
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayClick" id="trayClick-hide"> Hide
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayClick" id="trayClick-toggle"> Toggle
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayClick" id="trayClick-menu"> Menu
                                </label>

                            </div>
                        </div>

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Tray icon double click</label>
                            <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayDblClick" id="trayDblClick-none"> None
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayDblClick" id="trayDblClick-show"> Show
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayDblClick" id="trayDblClick-hide"> Hide
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayDblClick" id="trayDblClick-toggle"> Toggle
                                </label>
                                <label class="btn btn-default btn-xs">
                                    <input type="radio" name="trayDblClick" id="trayDblClick-menu"> Menu
                                </label>

                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="pref-pane" id="special-characters">
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Command stacking
                            <div class="input-group" style="width: 40px">
                                <input type="text" id="commandStackingChar" class="input-sm form-control" style="width: 40px" size="1" maxlength="1" />
                                <div class="input-group-addon">
                                    <label>
                                        <input type="checkbox" id="commandStacking" /> Enable</label>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Speedpaths
                            <div class="input-group" style="width: 40px">
                                <input type="text" id="speedpathsChar" class="input-sm form-control" style="width: 40px" size="1" maxlength="1" />
                                <div class="input-group-addon" style="border-left: 0px">
                                    <label>
                                        <input type="checkbox" id="enableSpeedpaths" /> Enable</label>
                                </div>
                                <div class="input-group-addon">
                                    <label>
                                        <input type="checkbox" id="parseSpeedpaths" /> Parse</label>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Command
                            <div class="input-group" style="width: 40px">
                                <input type="text" id="commandChar" class="input-sm form-control" style="width: 40px" size="1" maxlength="1" />
                                <div class="input-group-addon">
                                    <label>
                                        <input type="checkbox" id="enableCommands" /> Enable</label>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Escape
                            <div class="input-group" style="width: 40px">
                                <input type="text" id="escapeChar" class="input-sm form-control" style="width: 40px" size="1" maxlength="1" />
                                <div class="input-group-addon">
                                    <label>
                                        <input type="checkbox" id="allowEscape" /> Enable</label>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="col-sm-6 form-group">
                        <label class="control-label">
                            Verbatim
                            <div class="input-group" style="width: 40px">
                                <input type="text" id="verbatimChar" class="input-sm form-control" style="width: 40px" size="1" maxlength="1" />
                                <div class="input-group-addon">
                                    <label>
                                        <input type="checkbox" id="enableVerbatim" /> Enable</label>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog-footer">
        <button style="float: left" type="button" class="btn btn-default" onclick="resetSettings()">Reset</button>
        <button style="float: left" type="button" class="btn btn-default" onclick="backup()">Backup</button>
        <button style="float: right" type="button" class="btn btn-default" onclick="window.close()">Cancel</button>
        <button style="float: right" type="button" class="btn btn-primary" onclick="saveSettings()">Ok</button>
    </div>
    <dialog id="progress-dialog" style="z-index:1000;text-align:center">
        <div id="progress-dialog-title">Saving&hellip;</div>
        <div>
            <progress max="100" id="progress-dialog-progressbar"></progress>
        </div>
    </dialog>
</body>

</html>